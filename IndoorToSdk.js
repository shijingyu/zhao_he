(function($){$.extend({_isalert:0,alert:function(){if(arguments.length){$._isalert=1;$.confirm.apply($,arguments)}},confirm:function(){var a=arguments;if(a.length&&(typeof a[0]=="string")&&!$("#alert_overlay").length){if(!$("#alert_style").length){$("body").append('<style id="alert_style" type="text/css"> *{font-family:"微软雅黑","宋体";};#alert_overlay{position:fixed;width:100%;height:100%;top:0;left:0;z-index:999;background:#000;filter:alpha(opacity=5);opacity:.05}#alert_msg{position:fixed;width:200px;margin-left:-101px;left:50%;top:20%;z-index:1000;border:1px solid #aaa;-moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px;box-shadow:0 2px 10px rgba(0,0,0,.3);background:#fff}#alert_content{    font-weight: bold;font-size:14px;text-align:center;}#alert_buttons{border-top:1px solid #aaa;text-align:right;box-shadow:0 1px 0 #fff inset;background:#eee;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}#alert_buttons .alert_btn{padding:6px 12px;width:50%; flaot:left;  box-sizing: border-box;border:1px solid #fff;background:#fff;cursor:pointer;border-radius:2px;font-size:14px;outline:0;-webkit-appearance:none}#alert_buttons .alert_btn:hover{box-shadow:0 1px 2px #aaa;background:#eaeaea;color:#00b38b;}#alert_buttons .alert_btn:active{box-shadow:0 1px 2px #aaa inset;background:#e6e6e6}#alert_content span{ border-bottom:1px solid #00b38b; color:#00b38b; padding:10px 0; display: inline-block; width:100%;}#alert_txt{ text-align:left;  font-size:14px; color:#666666;    padding: 24px 8px}.alert_btn_cancel{ border-right: 1px solid #ccc !important;    color: #A2A2A2;}</style>')}var b=$('<div id="alert_overlay"></div><div id="alert_msg"><div id="alert_content">'+a[0]+'</div> <div id="alert_buttons"><button class="alert_btn alert_btn_cancel">取消</button><button class="alert_btn alert_btn_ok">确定</button></div></div>');if($._isalert){b.find(".alert_btn_cancel")}b.on("contextmenu",function(){return !1}).on("click",".alert_btn_ok",function(){b.remove();if(typeof a[1]=="function"){a[1].call($,!0)}}).on("click",".alert_btn_cancel",function(){b.remove();if(typeof a[1]=="function"){a[1].call($,!1)}}).appendTo("body");if((a[1])&&(typeof a[1]!="function")){var c=a[1];setTimeout(function(){b.remove()},c)}}$._isalert=0}})})($);var IndoorToMap={svgobjPub:"",createNew:function(E,F){var G={};var H=false;var I=E;var J=0;var K=F;var M,g_gpsMatch,g_signPackage,g_p0,g_p1,g_g0,g_g1,g_rsConfig,g_rsFloors,g_rsPubClass;var N=0;var O=true;var P;var Q;var S;var T;var U=0;var V=0;var W;var Z=null,sourceViewBox=null,sourceViewBoxSrc=null;var ba=null;var bb="http://www.w3.org/2000/svg";var bc=[];var bd=-1;var be="svg";var bf=false;var bg=-1;var bh=new Array(0,0,0,1);var bi=false;var bj=0;var bk=null;var bl;var bm=0;var bn=0;var bo=false;var bp=false;var bq;var br;var bs=-1;var bt;var bu;var bv;var bw=false;var bx;var by;var bz=new Array();var bA;var bB;var bC=new Array();var bD=new Array();var bE=true;var bF;var bG;var bH="http://i.vr100.com/";var bI=true;var bJ=null;var bK=true;var bL=true;var bM=new Array(0,0);var bN=true;var bO=true;var bP=true;var bQ=new Array(0,0);var bR=new Array();var bS=new Array();var bT=true;var bU=0;var bV=0;var bW=0;var bX,detail_pos,detail_FloorNumber;var bY=12;var bZ=true;var ca=1;var cb=yg=zg=lastXg=lastYg=lastZg=0;var cc=0;var cd=0;var ce=0;var cf=0;var cg=0;var ch;var ci=new Array();var cj=0;var ck=new Array();var cl=new Array();var cm=false;var cn;var co=true;var cp;var cq={"plant":"","iswx":""};var cr=false;var cs=false;var ct=Array();var cu=Array();var cv="";var cw=new Array();var cx=null;var cy=null;var cz={};var cA={"left":0,"top:":0};var cB=true;var cC=-80;var cD=1;var cE=3;var cF=false;G.exeInit=function(){var c=document.URL;var d="";var e=G.getUrlParam("appid");if(!e){e=I}$.ajax({url:"http://i.vr100.com/intest/datas/showUi_"+e+".json",type:"POST",data:{"jsName":d},dataType:"json",error:function(){alert("loading Data Error")},success:function(a,b){by=a.elements;bA=a.Floors;bB=a.PubElems;bJ=a.uuids;setInitParam(a.aFloor,a.gpsMatch,null,a.rsConfig,a.rsFloors,a.rsPubClass)}})};var setInitParam=function(a,b,c,d,e,f){M=eval("("+a+")");J=M.bid;g_gpsMatch=eval("("+b+")");g_signPackage=c;g_rsConfig=d;g_rsFloors=e;g_rsPubClass=f;if(g_gpsMatch!=null){g_p0=g_gpsMatch.p0.split(" ");g_p1=g_gpsMatch.p1.split(" ");g_g0=g_gpsMatch.g0.split(" ");g_g1=g_gpsMatch.g1.split(" ")}if(parseInt(M.rssidb)<-1){cC=parseInt(M.rssidb)}if(parseFloat(M.walkstepG)>=0){cD=parseFloat(M.walkstepG)}if(parseFloat(M.walkstep)>=0){cE=parseFloat(M.walkstep)}G.onload();var g=document.URL;G.callAjaxFunc({"funcName":"getWxParam","url":"http://i.vr100.com/intest/getWxParam.php"},g);G.setHTML();G.setToMyPos(true);G.initCompass();G.listenCtr();if(window.DeviceMotionEvent){window.addEventListener("devicemotion",G.deviceMotionHandler,false)}else{cF=false}};G.setWxInit=function(a){g_signPackage=a;try{G.wxConfig()}catch(e){alert(e)}};G.listenCtr=function(){$("#indoortomap_closeBtn").click(function(){G.turnToSearch(false)});$("#indoortomap_realSearch").on("input",function(e){G.callAjaxFunc("searchElem",this.value)
});$("#indoortomap_naviBtn").on("click",function(e){G.turnToSearch(false)});$("#indoortomap_tomypos").on("click",function(e){G.setToMyPos(true)});$("#indoortomap_closeContent").on("click",function(e){G.showContentPage(false)});$("#indoortomap_virSearch").on("focus",function(e){G.turnToSearch(true);document.getElementById("indoortomap_realSearch").focus()});$("#indoortomap_navup").on("click",function(e){G.slideFloor("up");G.turnFloorSlide(false)});$("#indoortomap_navdown").on("click",function(e){G.slideFloor("down");G.turnFloorSlide(false)});if(g_rsFloors!=null){var c=g_rsFloors.length;for(var i=0;i<c;i++){var d=g_rsFloors[i].id;var f="#floorLi_"+d;$(f).on("click",function(e){var a=this.id.substring(8);G.showFloor(a)})}}var g=$(".public-list li  ");for(var i=0;i<g.length;i++){var h=g[i].id;$("#"+h).on("click",function(e){var a=this.id.substring(6);G.setBlueColor(a)})}$("#indoortomap_Detail").on("click",function(e){var a=Img_Detail.src.indexOf("play.gif");if(a>0){var b=$("#car_audio");b[0].pause();Img_Detail.src="http://i.vr100.com/intest/AppUI3/images/pause.svg"}else{G.playAudioServ()}});$("#indoortomap_NaviToDetail").on("click",function(e){G.NaviToDetail()});$("#indoortomap_showContent").on("click",function(e){G.showContent()});$("#indoortomap_closeNavi").on("click",function(e){G.showNavi(false)})};G.wxConfig=function(){wx.config({debug:false,appId:"wxef152c081411934c",timestamp:g_signPackage.timestamp,nonceStr:g_signPackage.nonceStr,signature:g_signPackage.signature,jsApiList:["checkJsApi","startSearchBeacons","stopSearchBeacons","onSearchBeacons","openLocation","getLocation","scanQRCode"]});wx.ready(function(){G.playAudio("http://i.vr100.com/intest/audio/common/welcome.mp3");wx.startSearchBeacons({ticket:"",complete:function(a){G.searchBeacon()}});if(M.isGPS==1){setInterval(this.getPosByGPS,1000)}wx.checkJsApi({jsApiList:["onMenuShareTimeline","startSearchBeacons","stopSearchBeacons","onSearchBeacons"]})})};G.searchBeacon=function(){wx.onSearchBeacons({success:function(a){try{G.cpPos(a.beacons)}catch(e){}}})};G.getPosByGPS=function(){if(H){wx.getLocation({success:function(a){var b=a.latitude;var c=a.longitude;var d=a.speed;var e=a.accuracy;displayPositionWX(a)},cancel:function(a){alert("用户拒绝授权获取地理位置")}})}};G.playAudio=function(a){var b=$("#car_audio");if(a!=""){b.attr("src",a)}if(b.attr("src")==undefined){b.attr("src",b.data("src"))}b[0].play()};G.initScene=function(){N++;if(1==N){this.setHTML0();this.setHTML1();var a=document.URL;setTimeout(G.exeInit,500)}};G.openlayer=function(a,b,c,d){if(bI){var f='<div style="display:none;"><img src="'+a+'" style="width:100%;text-align:center;overflow:hidden;"></div> <br/> <div style=" height:65%;overflow:hidden;border:1px solid #eeeedd;text-align:center;width:90%;margin-left:5%;">'+b+"</div>";layer.open({type:1,shadeClose:true,shade:0.8,skin:"layui-layer-rim",area:["70%","80%"],content:f})}var g={"id":d,"audiourl":c,"picurl":a,"content":b};G.exeCallBack("getNearPop",g);var h=JSON.stringify(g);try{G.setParam("getNearPop",h)}catch(e){}};G.setHTML0=function(){searchstr="";searchstr='  <?xml version="1.0" encoding="utf-8" standalone="no" ?>  <svg id="svgRoot"  style="position:absolute; float:left;margin-top:0px;border:0px solid #ff0000" xmlns="http://www.w3.org/2000/svg" xmlns:cge="http://iec.ch/TC57/2005/SVG-schema#" xmlns:xlink="http://www.w3.org/1999/xlink" width="100%" height="100%" viewBox="0 0 100 100"   >   	<image preserveAspectRatio="xMinYMid slice" id="imgInit" x="0" y="0"  xlink:href="http://i.vr100.com/intest/images/elem/default.jpg" style="pointer-events:none;"  />   </svg> '+'<div id="embed_svg" style="width: 100%; height: 100%; border: 0px solid red; " type="image/svg+xml" />   </div>'+'<audio preload="auto" id="car_audio" src="http://i.vr100.com/intest/audio/common/startNavi.mp3"   ></audio>  ';$("#"+K).prepend(searchstr);searchstr="";searchstr='<div class="container" id="containerMain">'+'<div class="content" id="containerMaindown">'+'	<div class="clear"></div>'+"</div>"+' <div class="clear"></div>'+"</div>"+'<div class="icon-me"></div>'+'<div id="loading" class="loading" style="display:none;"><img src="http://i.vr100.com/intest/AppUI/images/loading.gif" style="width:40px;height:40px;"><p>loading...</p></div>';$("#"+K).prepend(searchstr);searchstr="";searchstr='  <div class="search-list"  id="divSearch" style="display:none;">'+' <div class="search-box">'+' 	<div class="search-main">'+' 		 <div class="search-icon">'+' 			 <a  class="return"   id="indoortomap_closeBtn"><img src="http://i.vr100.com/intest/AppUI3/images/close2.png"></a>'+" 		 </div>"+'  <div class="search-input"><input type="text" class="inputs" id="indoortomap_realSearch" placeholder="输入搜索"  /></div>'+' 		 <div class="search-menu">'+' 			 <a class="menu"   id="indoortomap_naviBtn"><img src="http://i.vr100.com/intest/AppUI3/images/Navigate.png"/></i></a>'+" 		 </div>"+" 	</div>"+" </div>"+' <ul id="div_SearchResult"  style="top:45px;">'+'   <div class="clear"></div>'+" </ul>"+"</div>";$("#containerMaindown").prepend(searchstr);
searchstr="";searchstr='  <div class="left-nav2 nav02"  id="compass">'+' <a    id="indoortomap_tomypos"><img src="http://i.vr100.com/intest/AppUI3/images/svg/toMyPos.svg" id="icon_dingwei" style="width:30px;"/></a>'+" </div>";$("#containerMaindown").append(searchstr);searchstr="";searchstr='  <div class="introduce"  style="display:none;margin-top:0px;margin-bottom:0px; z-index:1000 ;position: fixed;" id="div_Introduce">	'+'  <div class="title"><img src="http://i.vr100.com/intest/AppUI3/images/return.svg"  id="indoortomap_closeContent">&nbsp;&nbsp;&nbsp;&nbsp;<span> 详细介绍</span></div>'+' <div class="cont"  id="div_Content0" style=" overflow:scroll;">'+'   <div id="div_Content" style=" overflow:scroll;height:100%;"> </div>'+"  </div>"+"  </div>";$("#containerMaindown").append(searchstr)};G.setHTML1=function(){var a='<div id="searchBarDivR"></div>';$("#containerMain").prepend(a);var a='<div id="floorListDivR"></div>';$("#divSearch").after(a);var a='<div id="pubListDivR"></div>';$("#containerMaindown").append(a);var a='<div id="detailDivR"></div>';$("#containerMaindown").append(a);var a='<div id="naviDivR" ></div>';$("#containerMaindown").append(a)};G.setHTML=function(){var a="none";if(g_rsConfig.showSearchBar!=0){a="block"}var b='<div class="search-box" id="searchBarDiv"  style="display:'+a+';">'+'<div class="search-main">'+'<div class="search-icon">'+' <a  class="return" onclick="setParam(\'return\',\'1\');return false;"><img src="http://i.vr100.com/intest/AppUI3/images/return.png"></a>'+"</div>"+' <div class="search-input"><input type="text" class="inputs"  placeholder="输入搜索地" id="indoortomap_virSearch"  readonly="true" /></div>'+' <div class="search-menu">'+'   <a class="menu" onclick=""><img src="http://i.vr100.com/intest/AppUI3/images/list.png"/></i></a>'+"   </div>"+" </div>"+"  </div>";$("#searchBarDivR").html(b);if(g_rsFloors!=null){var c=g_rsFloors.length;b="";b='    <div class="left-nav nav01" id="floorListDiv">'+'<div class="nav-top"  id="indoortomap_navup"><i class="iconfont icon-top"><img src="http://i.vr100.com/intest/AppUI3/images/shang.png"></i></div>'+' <ul class="floor-list" id="divFloorList">';for(var i=0;i<c;i++){var d=g_rsFloors[i].id;var e=g_rsFloors[i].FloorNumber;var f=e;if(e<1){f=e-1}else{f=e}var g="";if(i==0){g='class="bluebg"'}else{g=""}b+='<li id="floorLi_'+d+'"   '+g+'  ><a href=""  >'+f+"F</a></li>"}b+="  </ul>"+' <div class="nav-dowm" id="indoortomap_navdown"><i class="iconfont icon-dowm"><img src="http://i.vr100.com/intest/AppUI3/images/xia.png"></i></div>'+"  </div>";$("#floorListDivR").html(b);var h=$(".floor-list li  ");h.click(function(){$(this).addClass("bluebg").siblings().removeClass("bluebg")});$(".floor-list li ").click(function(){return false});$(".nav-top,.nav-dowm").on("click",function(){if($(".floor-list").height()<=25){$(".floor-list li").show()}})}if(g_rsConfig.showPubBar!=0){b="";b='  <div class="left-nav nav03">'+' <div class="nav-top"><i class="iconfont icon-top"><img src="http://i.vr100.com/intest/AppUI3/images/shang.png"></i></div>'+'  <ul class="public-list" id="div_PubList">';var k=g_rsConfig.pubclassid;if(k==""||k==null){k="48||4||5||6||7||10"}var l=k.split("||");var m=l.length;var n=g_rsPubClass.length;var o="";for(var i=0;i<m;i++){var p=l[i];if(p){for(var j=0;j<n;j++){if(g_rsPubClass[j].id==p){var q=g_rsPubClass[j].name;var r=g_rsPubClass[j].icon;if(r.indexOf("http")==-1){r=bH+r}b+=' <li class="wc" id="liPub_'+p+'" ><a  ><img src="'+r+'" width="20" height="20"><br><span>'+q+"</span></a>  </li>"}}}}b+=" </ul>"+'<div class="nav-dowm"><i class="iconfont icon-dowm"><img src="http://i.vr100.com/intest/AppUI3/images/xia.png"></i></div>'+"</div>";$("#pubListDivR").html(b)}var a="none";if(g_rsConfig.isShowDetail!=0){a="block"}b="";b=' <div  style="display:'+a+';"> <div class="site" style="display:none;" id="div_Detail"  >'+' <div class="site-left" style=""><a  id="indoortomap_Detail"><img id="Img_Detail"  '+'src="http://i.vr100.com/intest/AppUI3/images/ad.png" /></a></div>'+' <div class="site-right">'+'   <p class="site-title" style="font-size:70%;line-height:15px "><span  id="div_DetailContent">1.格林童话</span><span class="title-right" id="DivFloorNumber"></span></p>'+'   <p class="site-text" id="div_DetailPop" >格林童话书屋</p>'+'   <p class="site-a">'+'	<a   class="here"  ><span class="iconfont icon-here"  id="indoortomap_NaviToDetail"><img src="http://i.vr100.com/intest/AppUI3/images/there.png" style="width:10px;height:10px;">去这里</span> </a>'+'	<a  class="right1" style="display:block;"  id="indoortomap_showContent"> <span class="iconfont icon-right1"><img src="http://i.vr100.com/intest/AppUI3/images/details.png" style="width:10px;height:10px;" >详情</span></a>'+"	</p>"+"    </div>"+"   </div>  </div>";$("#detailDivR").html(b);var a="none";if(g_rsConfig.isShowNavi!=0){a="block"}b="";b=' <div id="div_NaviRoot" style="display:'+a+';"> <div class="site02" style="display:none;" id="div_Navi"   >'+'<div class="site02-left" id="indoortomap_closeNavi"><img src="http://i.vr100.com/intest/AppUI3/images/close.png"/></div>'+' <div class="site02-min" style="padding-right:10px;"><p><span id="pathAll">路线加载中,请稍等...</span> <sapn id="naviWord"></span></p></div>'+' <div class="site02-right" style="display:none;"><img src="http://i.vr100.com/intest/AppUI3/images/icon01.png"/></br>新东方</div>'+"  </div></div>";
$("#naviDivR").html(b)};G.turnFloorSlide=function(a){var b=$(".floor-list li  ");if(a){for(var i=0;i<b.length;i++){var c=b[i].className;if(c=="bluebg"){}else{b[i].style.display="none"}}}else{for(var i=0;i<b.length;i++){b[i].style.display="block"}}O=a};G.slideFloor=function(a){if(!O){var b=$(".floor-list li  ");for(var i=0;i<b.length;i++){var c=b[i].className;if(c=="bluebg"){if(a=="up"&&i>=1){var d=b[i-1]}else{if(a=="down"&&(i<b.length-1)){var d=b[i+1]}}}}d.click()}};G.setFloorClick=function(a){this.turnFloorSlide(false);var b=$(".floor-list li  ");for(var i=0;i<b.length;i++){var c="floorLi_"+a;if(c==b[i].id){var d=b[i];d.click()}}};G.callAjaxFunc=function(o,p,q,r,s,t,u,v,w,x){var y="http://i.vr100.com/intest/showUiSer.php";var z=o;if(typeof(o)=="object"){y=o.url;z=o.funcName}$.ajax({url:y,type:"POST",data:{"Func":z,"bid":J,"appid":I,"param1":p,"param2":q,"param3":r,"param4":s,"param5":t,"param6":u,"param7":v,"param8":w,"param9":x},dataType:"json",error:function(){$.alert("Error loading XML document")},success:function(a,b){var c=a.datas;var d=c.length;for(var i=0;i<d;i++){var f=c[i];var g=f.length;if(g<2){continue}var h=f[0];var j=f[1];var k="G."+j;if(j.indexOf("outer.")>-1){k=j.replace("outer.","")}try{if(h=="addScriptCall"){if(g==2){eval(k)()}else{if(g==3){eval(k)(f[2])}else{if(g==4){eval(k)(f[2],f[3])}else{if(g==5){eval(k)(f[2],f[3],f[4])}else{if(g==6){eval(k)(f[2],f[3],f[4],f[5])}else{if(g==7){eval(k)(f[2],f[3],f[4],f[5],f[6])}else{if(g==8){eval(k)(f[2],f[3],f[4],f[5],f[6],f[7])}else{if(g==9){eval(k)(f[2],f[3],f[4],f[5],f[6],f[7],f[8])}else{if(g==10){eval(k)(f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9])}}}}}}}}}}else{if(h=="addAssign"){if(g!=4){continue}var l=f[3];var m=l.indexOf("iframe");if(m==-1){l=l.replace(/\r|\n/ig,"")}var n='document.getElementById("'+f[1]+'").'+f[2]+"='"+l+"';";eval(n)}}}catch(e){alert(e)}}}})};G.callAjaxFuncOuter=function(o,p,q,r,s,t,u,v,w,x){$.ajax({url:"http://i.vr100.com/intest/showUiSer.php",type:"POST",data:{"Func":o,"bid":J,"appid":I,"param1":p,"param2":q,"param3":r,"param4":s,"param5":t,"param6":u,"param7":v,"param8":w,"param9":x},dataType:"json",error:function(){$.alert("Error loading XML document")},success:function(a,b){var c=a.datas;var d=c.length;for(var i=0;i<d;i++){var f=c[i];var g=f.length;if(g<2){continue}var h=f[0];var j=f[1];try{if(h=="addScriptCall"){if(g==2){var k=""+j;eval(k)()}else{if(g==3){var k=""+j;eval(k)(f[2])}else{if(g==4){var k=""+j;eval(k)(f[2],f[3])}else{if(g==5){var k=""+j;eval(k)(f[2],f[3],f[4])}else{if(g==6){var k=""+j;eval(k)(f[2],f[3],f[4],f[5])}else{if(g==7){var k=""+j;eval(k)(f[2],f[3],f[4],f[5],f[6])}else{if(g==8){var k=""+j;eval(k)(f[2],f[3],f[4],f[5],f[6],f[7])}else{if(g==9){var k=""+j;eval(k)(f[2],f[3],f[4],f[5],f[6],f[7],f[8])}else{if(g==10){var k=""+j;eval(k)(f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9])}}}}}}}}}}else{if(h=="addAssign"){if(g!=4){continue}var l=f[3];var m=l.indexOf("iframe");if(m==-1){l=l.replace(/\r|\n/ig,"")}var n='document.getElementById("'+f[1]+'").'+f[2]+"='"+l+"';";eval(n)}}}catch(e){alert(e)}}}})};G.myBrowser=function(){cq={"plant":"","iswx":""};var a=navigator.userAgent;var b=a.indexOf("Opera")>-1;if(a.indexOf("iPhone")>-1){cq.plant="iPhone"}else{if(a.indexOf("Opera")>-1){cq.plant="Opera"}else{if(a.indexOf("Firefox")>-1){cq.plant="FF"}else{if(a.indexOf("Opera")>-1){cq.plant="Chrome"}else{if(a.indexOf("Safari")>-1){cq.plant="Safari"}else{if(a.indexOf("compatible")>-1&&a.indexOf("MSIE")>-1&&!b){cq.plant="IE"}}}}}}var c=a.toLowerCase();if(c.match(/MicroMessenger/i)=="micromessenger"){cq.iswx="true"}};G.browserLoad=function(){var a=this.myBrowser();if("iPhone"==a){cq="iPhone"}else{cq="Android"}};G.orientationChange=function(){switch(window.orientation){case 0:HvState=0;break;case 180:HvState=2;break;case -90:HvState=3;break;case 90:HvState=1;break}};G.initCompass=function(){window.addEventListener("onorientationchange" in window?"orientationchange":"resize",G.orientationChange,false);var e=document.getElementById("compass");if(window.DeviceOrientationEvent){window.addEventListener("deviceorientation",function(a){var b;if(a.webkitCompassHeading){b=a.webkitCompassHeading;var c=-parseFloat(b)+0;U=parseFloat(b);V=U+parseFloat(M.northOffset);e.style.WebkitTransform="rotate("+c+"deg)";if(Q){var d=parseFloat(b)+0}}else{b=a.alpha;if(W){$.alert(W);U=W;V=U+parseFloat(M.northOffset);webkitAlpha=-W}else{U=-b;V=U+parseFloat(M.northOffset);webkitAlpha=b}e.style.WebkitTransform="rotate("+webkitAlpha+"deg)"}},false)}};G.deviceMotionHandler=function(a){cF=true;var b=a.accelerationIncludingGravity;cb=b.x;yg=b.y;zg=b.z;var c=Math.sqrt((yg-lastYg)*(yg-lastYg)+(zg-lastZg)*(zg-lastZg));cf+=c;cg=cg+1;ce=cf/cg;var d=0.45;var e=0.8;var f=0.001*cD;if(cq.plant=="iPhone"){d=0.6;e=2;f=0.045}else{d=0.6;e=2;f=0.04}if(c>d&&c<e){cc+=f*c*Math.sin(V*Math.PI/180);cd+=f*(0-c*Math.cos(V*Math.PI/180))}lastXg=cb;lastYg=yg;lastZg=zg;$("#iptTest").val(bK);if(bK==false){if(cB==true){cB=false;$("#iptTest2").val(cB);cu=Array();setTimeout(G.computePosStop,5000)}}else{cB=true
}};G.isWalkOn=function(){if(ce>0.2){bK=true}else{bK=false}ce=0;cf=0;cg=0};G.isOperateOn=function(){if(bo){if(!bi){var a=new Date().getTime();if(a-cp>2000){G.setToMyPos(true)}}}};G.loadSvg=function(b){var c="http://i.vr100.com/intest/getDataXML.php?svgUrl="+b+"";try{$.ajax({url:c,type:"GET",dataType:"xml",timeout:3000,cache:false,error:function(a){G.clearSvgFont()},success:this.GetSvgComplete})}catch(e){alert(e.message)}};G.GetSvgComplete=function(a){try{G.clearSvgBg();var b=a;var c=b.getElementsByTagName("svg");var d=c[0];d.setAttribute("preserveAspectRatio","xMinYMin meet");d.setAttribute("width",bq);d.setAttribute("height",br);d.setAttribute("id","svg_bg");d.setAttribute("style","pointer-events:none");var f=Z.getElementById("svg_font");if(f){ba.insertBefore(b.documentElement,f)}else{var g=Z.getElementById("group_Elements");if(!g){var g=document.createElementNS(bb,"g");g.id="group_Elements";g.style.zIndex=100;ba.appendChild(g)}ba.insertBefore(b.documentElement,g)}G.exeCallBack("floorMapLoadSvg",bg);try{G.setParam("floorMapLoadSvg",bg)}catch(e){}}catch(e){}};G.loadSvgFont=function(b){var c="http://i.vr100.com/intest/getDataXML.php?svgUrl="+b+"";try{$.ajax({url:c,type:"GET",dataType:"xml",timeout:3000,cache:false,error:function(a){G.clearSvgFont()},success:this.GetFontComplete})}catch(e){alert(e.message)}};G.GetFontComplete=function(a){try{G.clearSvgFont();var b=a;var c=b.getElementsByTagName("svg");svgFont=c[0];var d=b.getElementsByTagName("path");var f=d.length;for(var i=0;i<f;i++){d[i].style="fill-opacity:0.001;fill:#FFFFFF;stroke-width:0"}var d=b.getElementsByTagName("rect");var f=d.length;for(var i=0;i<f;i++){d[i].style="fill-opacity:0.001;fill:#FFFFFF;stroke-width:0"}var d=b.getElementsByTagName("polygon");var f=d.length;for(var i=0;i<f;i++){d[i].style="fill-opacity:0.001;fill:#FFFFFF;stroke-width:0"}var d=b.getElementsByTagName("ellipse");var f=d.length;for(var i=0;i<f;i++){d[i].style="fill-opacity:0.001;fill:#FFFFFF;stroke-width:0"}svgFont.setAttribute("preserveAspectRatio","xMinYMin meet");svgFont.setAttribute("width",bq);svgFont.setAttribute("height",br);var g=Z.getElementById("group_Elements");if(!g){var g=document.createElementNS(bb,"g");g.id="group_Elements";g.style.zIndex=100;ba.appendChild(g)}ba.insertBefore(b.documentElement,g);svgFont.setAttribute("id","svg_font");G.exeCallBack("floorMapLoadSvgFont",bg);try{G.setParam("floorMapLoadSvgFont",bg)}catch(e){}}catch(e){}};G.clearSvgFont=function(){try{var a=Z.getElementById("svg_font");if(a){ba.removeChild(a)}}catch(e){}};G.clearSvgBg=function(){try{var a=Z.getElementById("svg_bg");if(a){ba.removeChild(a)}}catch(e){}Z.getElementById("imgInit").href.baseVal=""};G.showFloorAndElem=function(a,b,c,d,e,f){if(a!=""){if(a.indexOf(".svg")!=-1||a.indexOf(".svgz")!=-1){this.loadSvg(a)}else{Z.getElementById("imgInit").href.baseVal=a}var g=a.replace(".svg","_font.svg");if(b==""){b="100"}if(c==""){c="100"}Z.getElementById("imgInit").setAttribute("width",b);Z.getElementById("imgInit").setAttribute("height",c);bq=b;br=c;this.loadSvgFont(g)}this.clearFocusCircle();this.createFocusCircle(d,e);this.signTap2(e);this.setViewByPos(e);bg=f;if(true){this.showDetail(true);this.setToMyPos(false);this.setFloorClick(f)}if(bh[3]!=bg){$("#sign_myPos").hide();$("#group_PathTemp").hide()}else{$("#sign_myPos").show();$("#group_PathTemp").show()}};G.onload=function(){G.playAudio("http://i.vr100.com/intest/audio/common/welcome.mp3");var a=parseInt(document.getElementById(K).style.height);var b=parseInt(document.getElementById(K).style.width);document.getElementById(K).style.width=b+"px";document.getElementById(K).style.height=a+"px";document.getElementById("embed_svg").style.width=b+"px";document.getElementById("embed_svg").style.height=a+"px";document.getElementById("svgRoot").style.width=b+"px";document.getElementById("svgRoot").style.height=a+"px";var c=a-20;document.getElementById("div_Content0").style.width=b+"px";document.getElementById("div_Content0").style.height=c+"px";if(M.webbackground!=""){document.body.style.background=M.webbackground}bf=false;this.initSvg();this.myBrowser();setInterval(this.isWalkOn,1500);setInterval(this.isOperateOn,200);this.drawPtReal()};G.getDetailIdByERPNumber=function(a){var b="";var c=by.length;if(a!=""){for(var i=0;i<c;i++){if(by[i].ERPNumber==a){b=by[i].id}}}return b};G.loadLayer=function(){var a=M;bq=M.realWidth;br=M.realHeight;bt=a.detailId;G.loadMap(a.detailId,a.FloorId,a);G.loadElemsFloor(bt,a.FloorId)};G.loadMap=function(a,b,c){var d="";if(c=="undefined"||c==null){d=this.getFloorByIds(a,b)}else{d=c}if(d.svgUrl!=""){var f=100;var g=100;var h=d.svgUrl;if(h.indexOf("http")==-1){h=bH+h}if(h.indexOf(".svg")!=-1||h.indexOf(".svgz")!=-1){this.loadSvg(h)}else{G.clearSvgBg();Z.getElementById("imgInit").href.baseVal=h;G.exeCallBack("floorMapLoadImage",bg);try{G.setParam("floorMapLoadImage",bg)}catch(e){}}var i=d.svgUrlFont;if(i.indexOf("http")==-1){i=bH+i}if(d.realWidth!=""){f=d.realWidth}if(d.realHeight!=""){g=d.realHeight}Z.getElementById("imgInit").setAttribute("width",f);
Z.getElementById("imgInit").setAttribute("height",g);bq=f;br=g;if(b!=""){bg=b}else{if(d.FloorId!=""){bg=d.FloorId}}this.loadSvgFont(i);if(bE){bF=bq/100;this.scaleViewProcess(bF*1.2);var j=bq/2;var k=br/8;this.setViewByPos(j+" "+k);bE=false;G.exeCallBack("isMapLoad","1");try{G.setParam("isMapLoad","1")}catch(e){}}}this.clearFocusCircle();if(a){var l="";if(c=="undefined"||c==null){l=this.getPosById(a)}else{l=c}var m=a;if(l.pos!=""){this.createFocusCircle(m,l.pos);this.signTap2(l.pos);this.setViewByPos(l.pos);bg=l.FloorId;this.callAjaxFunc("showDetailInfo",m,true);this.showDetail(true);this.setToMyPos(false);this.setFloorClick(l.FloorId);setTimeout("showPath()",1000)}}if(bh[3]!=bg){$("#sign_myPos").hide();$("#group_PathTemp").hide()}else{$("#sign_myPos").show();$("#group_PathTemp").show()}};G.showPath=function(){var a=Math.abs(bh[0])+Math.abs(bh[1]);if(bX&&a>10){var b=detail_pos.split(" ");var z=(detail_FloorNumber-1)*4;var c=new Array(b[0],b[1],z);this.callAjaxFunc("computePath",bh[0],bh[1],bh[2],c[0],c[1],c[2],true);turnToSearch(false)}else{setTimeout("showPath()",1000)}};G.loadElemsFloor=function(a,b){var c="";var d=by.length;c=this.getFloorNumberByIds(a,b);if(c==""){c="1"}var e=new Array();for(var i=0;i<d;i++){if(by[i].FloorNumber==c){e.push(by[i])}}var f=JSON.stringify(e);this.showElements(f);var g=G.getUrlParam("naviId");if(g!=""||g!="undefined"){this.naviById(g)}};G.getFloorNumberByIds=function(a,b){var c="";var d=by.length;for(var i=0;i<d;i++){if(by[i].id==a){c=by[i].FloorNumber}}if(c==""){for(var i=0;i<d;i++){if(by[i].FloorId==b){c=by[i].FloorNumber}}}if(c==""){var e=this.getFloorByIds("",b);c=e.FloorNumber}return c};G.getFloorByIds=function(a,b){var c={svgUrl:"",svgUrlFont:"",realWidth:"",realHeight:"",FloorId:"",FloorNumber:""};var d="";var e=by.length;for(var i=0;i<e;i++){if(by[i].id==a){d=by[i].FloorId}}if(d==""){d=b}if(d==""){var f=bA.length;for(var i=0;i<f;i++){if(bA[i].FloorNumber==1){d=bA[i].FloorId}}}if(d!=""){var f=bA.length;for(var i=0;i<f;i++){if(bA[i].FloorId==d){c.svgUrl=bA[i].svgUrl;c.svgUrlFont=bA[i].svgUrlFont;c.realWidth=bA[i].realWidth;c.realHeight=bA[i].realHeight;c.FloorId=bA[i].FloorId;c.FloorNumber=bA[i].FloorNumber}}}return c};G.getPosById=function(a){var b={pos:"",FloorId:"",FloorNumber:""};var c=by.length;for(var i=0;i<c;i++){if(by[i].id==a){b.pos=by[i].pos;b.FloorId=by[i].FloorId;b.FloorNumber=by[i].FloorNumber}}return b};G.getUrlParam=function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)");var r=window.location.search.substr(1).match(b);if(r!=null){return unescape(r[2])}return null};G.searchElemPub=function(a){var b=new Array();var c=bB.length;for(var i=0;i<c;i++){if(bB[i].RoomType==a&&bB[i].FloorId==bg){b.push(bB[i])}}this.searchChange(JSON.stringify(b),"","pub");bs=a};G.initSvg=function(){if(bf==false){var a=document.getElementById("svgRoot");if(a!=null){var b=a.getElementsByTagName("svg");if(b){bf=true;this.initEvent();this.loadLayer()}}}if(bf==false){setTimeout("initSvg()",10000)}};G.initEvent=function(){Z=document.getElementById("svgRoot");cA.left=$("#svgRoot").offset().left;cA.top=$("#svgRoot").offset().top;var j=document.createElementNS(bb,"g");j.id="groupRoot";Z.appendChild(j);ba=Z.getElementById("groupRoot");var k=Z.getElementById("imgInit");ba.appendChild(k);Z.setAttribute("preserveAspectRatio","xMinYMin meet");this.getViewBox();this.getViewBoxSrc();var l=new Hammer(document.getElementById("svgRoot"));l.add(new Hammer.Pan());l.add(new Hammer.Pinch());l.add(new Hammer.Tap());l.on("pinchmove pinchstart",function(e){if(e.type=="pinchmove"){G.exeCallBack("pinchmove",e);var a=1/e.scale;G.scaleViewProcess(a)}else{G.exeCallBack("pinchstart",e);G.getViewBox();G.setToMyPos(false)}});l.on("panstart panmove",function(e){if(e.type=="panmove"){G.exeCallBack("panmove",e);var x=e.deltaX,y=e.deltaY;if(be=="svg"){G.panViewProcess(x,y)}else{var x=e.center.x-cA.left;var y=e.center.y-cA.top;var a={clientX:x,clientY:y};var b=G.getSvgPos(a)}}else{if(e.type=="panstart"){G.exeCallBack("panstart",e);G.setToMyPos(false);be="svg";G.getViewBox()}}});l.on("tap",function(e){G.cancelSelected();var a=e.target.id;var b=Z.getElementById("group_picker");if(b){while(b.firstChild){b.removeChild(b.firstChild)}}if(e.target.nodeName=="polygon"||e.target.nodeName=="rect"||e.target.nodeName=="path"||e.target.nodeName=="ellipse"){G.pickedObj(e.target)}var c=e.center.x-cA.left;var d=e.center.y-cA.top;var f={clientX:c,clientY:d};var g=G.getSvgPos(f);var h={"x":g.x,"y":g.y,"clientX":c,"clientY":d,"id":a};G.exeCallBack("click",h);var i=JSON.stringify(h);try{G.setParam("click",i)}catch(e){}if(!bo){G.computeHitNode(g)}});l.on("doubletap",function(e){G.exeCallBack("dbclick",e);var a=JSON.stringify(e);try{G.setParam("dbclick",a)}catch(e){}G.getViewBox();G.scaleViewProcess(0.6)});$(Z).mousewheel(function(a,b){G.exeCallBack("mousewheel",b);G.getViewBox();if(b>0){G.scaleViewProcess(0.9)}else{G.scaleViewProcess(1/0.9)}a.stopPropagation();a.preventDefault()})};G.pickedObj=function(a){var b=a.cloneNode(true);b.style.cssText="stroke:#FF0000;stroke-width:"+M.realWidth*0.04+";fill:#FFFF00;fill-opacity:0.2;pointer-events:none;";
var c=Z.getElementById("group_picker");if(!c){var c=document.createElementNS(bb,"g");c.id="group_picker";c.style.zIndex=88;a.parentNode.appendChild(c)}c.appendChild(b)};G.scaleViewProcess=function(a){var b=Z;var c=sourceViewBox.x+sourceViewBox.width*(1-a)*0.5;var d=sourceViewBox.y+sourceViewBox.height*(1-a)*0.5;var f=sourceViewBox.width*a;var g=sourceViewBox.height*a;var h=f/sourceViewBoxSrc.width;if(h>0.2*sourceViewBoxSrc.width||h<40/sourceViewBoxSrc.width){}bG=h;var i=c+" "+d+" "+f+" "+g+" ";b.setAttribute("viewBox",i);try{this.scaleNaviElemReal(h);this.scaleMarkerReal(h);this.scaleTReal(h)}catch(e){}this.hideElemByScale()};G.scaleNaviElemReal=function(a){var b=new Array("pt_sign","pt_start","pt_end");for(var i=0;i<b.length;i++){try{var c=Z.getElementById(b[i]);var d=parseFloat(c.getAttribute("width0"));var f=parseFloat(c.getAttribute("height0"));c.setAttribute("width",a*d);c.setAttribute("height",a*f);var g=parseFloat(c.getAttribute("x0"));var h=parseFloat(c.getAttribute("y0"));var j=0;var k=0;if("pt_sign"==b[i]){k=-a*f*0.5}var l=g-(a*d*0.5)+j;var m=h-(a*f*0.5)+k;c.setAttribute("x",l);c.setAttribute("y",m)}catch(e){}}try{var c=Z.getElementById("sign_myPos");c.setAttribute("width",a*24);c.setAttribute("height",a*24);var g=parseFloat(c.getAttribute("x0"));var h=parseFloat(c.getAttribute("y0"));var l=g-(a*24*0.5);var m=h-(a*24*0.5);Q.firstChild.setAttribute("x",l);Q.firstChild.setAttribute("y",m)}catch(e){}var n=M.iconsize;var o=Z.getElementById("group_Elements");if(M.iconsize==""||M.iconsize==null||M.iconsize=="undefined"){n=1}var p=o.childElementCount;for(var i=0;i<p;i++){try{try{var q=o.children[i]}catch(e){var q=o.childNodes.item(i)}if(q.nodeName=="text"){var r=a*3*n;q.setAttribute("font-size",r);q.setAttribute("stroke-width",r*0.002)}else{var r=a*8*n;q.setAttribute("width",r);q.setAttribute("height",r)}var g=parseFloat(q.getAttribute("x0"));var h=parseFloat(q.getAttribute("y0"));var j=0;var k=0;var l=g-(a*8*0.5)+j;var m=h-(a*8*0.5)+k;q.setAttribute("x",l);q.setAttribute("y",m)}catch(e){}}try{var s=Z.getElementById("path_navi");s.setAttribute("stroke-width",a*1);s.setAttribute("stroke-dasharray",a*1,a*1);var t=Z.getElementById("path_naviTemp");t.setAttribute("stroke-width",a*1);t.setAttribute("stroke-dasharray",a*1,a*1)}catch(e){}try{var u=Z.getElementById("group_searchElem");var v=u.childElementCount;for(var i=0;i<v;i++){try{var q=u.children[i]}catch(e){var q=u.childNodes.item(i)}if(q.id.indexOf("searchElem_")>=0){var w=parseFloat(q.getAttribute("x0"));var x=parseFloat(q.getAttribute("y0"));var y=w-(a*4*0.5);var z=x-(a*4*0.5);q.setAttribute("x",y);q.setAttribute("y",z);q.setAttribute("width",a*4);q.setAttribute("height",a*4)}else{if(q.id.indexOf("searchElemSign_")>=0){var w=parseFloat(q.getAttribute("x0"));var x=parseFloat(q.getAttribute("y0"));var y=w-(a*8*0.5);var z=x-(a*16*0.5);q.setAttribute("x",y);q.setAttribute("y",z);q.setAttribute("width",a*8);q.setAttribute("height",a*8)}}}}catch(e){}};G.scaleTextReal=function(a,b){var c=b.childElementCount;for(var i=0;i<c;i++){try{var d=b.children[i]}catch(e){var d=b.childNodes.item(i)}if(d.nodeName=="path"){var f=d.getBBox();var g=f.width/a;if(g<160){d.setAttribute("fill-opacity","0.01")}else{d.setAttribute("fill-opacity","1")}}else{if(d.nodeName=="g"){this.scaleTextReal(a,d)}}}};G.panViewProcess=function(x,y){var a=Z;var b=$(Z).width();var c=$(Z).height();var d=sourceViewBox.width/b;var e=sourceViewBox.height/c;var f=Math.max(d,e);var g=sourceViewBox.x-x*f;var h=sourceViewBox.y-y*f;var i=sourceViewBox.width;var j=sourceViewBox.height;var k=sourceViewBoxSrc.x+sourceViewBoxSrc.width;var l=g+i;if(g>k-sourceViewBoxSrc.width*0.5||l<sourceViewBoxSrc.x+sourceViewBoxSrc.width*0.5){}var m=sourceViewBoxSrc.y+sourceViewBoxSrc.height;var n=h+j;if(h>m||n<sourceViewBoxSrc.y){}var o=g+" "+h+" "+i+" "+j+" ";a.setAttribute("viewBox",o)};G.setViewByPos=function(a){this.getViewBox();var b=a.split(" ");var c=parseFloat(b[0]);var d=parseFloat(b[1]);var e=Z;var f=sourceViewBox.width;var g=sourceViewBox.height;var h=c-(f*0.5);var i=d-(g*0.5);var j=h+" "+i+" "+f+" "+g+" ";e.setAttribute("viewBox",j)};G.setViewByTempSeg=function(a){var b=1000000;var c=1000000;var d=-1000000;var e=-1000000;var f=a.length;for(var i=0;i<f;i++){if(a[i][0]<b){b=a[i][0]}if(a[i][0]>d){d=a[i][0]}if(a[i][1]<c){c=a[i][1]}if(a[i][1]>e){e=a[i][1]}}this.getViewBox();var b=parseFloat(b);var d=parseFloat(d);var c=parseFloat(c);var e=parseFloat(e);var g=(b+d)/2;var h=(c+e)/2;var j=Z;var k=(d-b)*1.5;var l=(e-c)*1.5;var m=g-(k*0.5);var n=1;if(k>10){n=(d-b)/(e-c)*1.2}var o=h-(l*0.5*n);var p=m+" "+o+" "+k+" "+l+" ";j.setAttribute("viewBox",p)};G.getSvgPos=function(a){var b=Z;var c=b.getAttribute("viewBox");vboxArr=c.split(" ");var d=parseFloat(vboxArr[0]);var e=parseFloat(vboxArr[1]);var f=Math.abs(parseFloat(vboxArr[2]));var g=Math.abs(parseFloat(vboxArr[3]));var h=$(b).width();var i=$(b).height();var j=f/h;var k=g/i;var l=Math.max(j,k);var m=a.clientX;var n=a.clientY;var o=d+m*l;var p=e+n*l;return{x:o,y:p}};G.getViewBox=function(){var a=Z.getAttribute("viewBox");
vboxArr=a.split(" ");var b=parseFloat(vboxArr[0]);var c=parseFloat(vboxArr[1]);var d=Math.abs(parseFloat(vboxArr[2]));var e=Math.abs(parseFloat(vboxArr[3]));sourceViewBox={x:b,y:c,width:d,height:e}};G.getViewBoxSrc=function(){var a=Z.getAttribute("viewBox");vboxArr=a.split(" ");var b=parseFloat(vboxArr[0]);var c=parseFloat(vboxArr[1]);var d=Math.abs(parseFloat(vboxArr[2]));var e=Math.abs(parseFloat(vboxArr[3]));sourceViewBoxSrc={x:b,y:c,width:d,height:e}};G.computeHitNode=function(a){var b=10000000000;var c=null;var d=null;var x=parseFloat(a.x);var y=parseFloat(a.y);var f=Z.getElementById("group_Elements");var g=f.childElementCount;for(var i=0;i<g;i++){try{var h=f.children[i]}catch(e){var h=f.childNodes.item(i)}if(h.nodeName=="circle"){var j=parseFloat(h.getAttribute("cx"));var k=parseFloat(h.getAttribute("cy"));var l=Math.sqrt(((x-j)*(x-j))+((y-k)*(y-k)));if(l<b){b=l;c=h;d={x:j,y:k}}}}if(b<M.realWidth*0.05){var m=c.id;var n=parseInt(m.substring(11,40));this.showDetail(true);this.callAjaxFunc("showDetailInfo",n);this.turnFloorSlide(true);this.signTap(d);var o=this.getPoiByIdInner(n);G.exeCallBack("getPoiByClick",o);var p=JSON.stringify(o);try{G.setParam("getPoiByClick",p)}catch(e){}}else{this.showDetail(false);this.turnFloorSlide(false);this.clearPath("group_SignTap");G.exeCallBack("cancelSelect",a);var q=JSON.stringify(a);try{G.setParam("cancelSelect",q)}catch(e){}}};G.signTap2=function(a){var b=a.split(" ");var c=b[0];var d=b[1];var e={x:c,y:d};this.signTap(e)};G.signTap=function(a){this.clearPath("group_SignTap");var b={id:"pt_sign",x:a.x,y:a.y,r:1,text:"起",width:4,height:4,href:bH+"/intest/images/elem/select.svg"};this.createSignMarker(b,"group_SignTap");this.scaleNaviElemReal(bG)};G.createFocusCircle=function(a,b){var c=b.split(" ");var d=c[0];var e=c[1];var r=0.000001;var f=Z.getElementById("group_focuselement");if(!f){var f=document.createElementNS(bb,"g");f.id="group_focuselement";f.style.zIndex=100;ba.appendChild(f)}var g=$(document.createElementNS(bb,"circle"));g.attr("id",a).attr("cx",d).attr("cy",e).attr("r",r).attr("fill","#076e2c").attr("fill-opacity","0.5");g.appendTo($(f));var h={id:a,x:d,y:e,r:r};bc.push(h)};G.createSignMarker=function(a,b){var c=a.x;var d=a.y;var e=parseFloat(a.x)-parseFloat(a.width)*0.5;var f=parseFloat(a.y)-parseFloat(a.height)*0.5;var r=a.r;var g=a.id;var h=Z.getElementById(b);if(!h){var h=document.createElementNS(bb,"g");h.id=b;h.style.zIndex=100;ba.appendChild(h)}var i=document.createElementNS(bb,"image");i.href.baseVal=a.href;i.setAttribute("preserveAspectRatio","xMidYMid meet");i.setAttribute("id",a.id);$(i).attr("x",e).attr("y",f).attr("x0",c).attr("y0",d).attr("width",a.width).attr("height",a.height).attr("width0",a.width).attr("height0",a.height);h.appendChild(i)};G.createSignMarker2=function(a,b){var c=a.x;var d=a.y;var e=parseFloat(a.x)-0;var f=parseFloat(a.y)-0;var r=a.r;var g=a.id;var h=Z.getElementById(b);if(!h){var h=document.createElementNS(bb,"g");h.id=b;h.style.zIndex=100;ba.appendChild(h)}var i=document.createElementNS(bb,"image");i.href.baseVal=a.href;i.setAttribute("preserveAspectRatio","xMinYMin meet");i.setAttribute("id",a.id);$(i).attr("x",e).attr("y",f).attr("width",a.width).attr("height",a.height).attr("x0",c).attr("y0",d);h.appendChild(i)};G.showElements=function(a){this.clearElements("group_Elements");bx=null;var b=Z.getElementById("group_Elements");if(!b){var b=document.createElementNS(bb,"g");b.id="group_Elements";b.style.zIndex=100;ba.appendChild(b)}var c=eval("("+a+")");bx=c;var d=c.length;for(var i=0;i<d;i++){var e=c[i].pos.split(" ");var f=parseFloat(e[0]);var g=parseFloat(e[1]);var h=f+0.2;var j=g+0.2;var k=document.createElementNS(bb,"text");k.textContent=c[i].name;$(k).attr("id","elemText_"+c[i].id).attr("x",f).attr("y",g).attr("x0",f).attr("y0",g).attr("font-size",4).attr("font-family","黑体").attr("fill","#555555").attr("stroke","white").attr("stroke-width","0");b.appendChild(k);var l=document.createElementNS(bb,"circle");l.id="elemCircle_"+c[i].id;var m;if(M.iconsize==""||M.iconsize==null||M.iconsize=="undefined"||M.iconsize==0){m=M.realWidth*0.025}else{m=parseFloat(M.iconsize)}$(l).attr("cx",f).attr("cy",g).attr("r",0.1).attr("fill","#ff3f00").attr("fill-opacity","0.5");b.appendChild(l);newR2=m*2;var n=f-newR2*0.5;var o=g-newR2*0.5;var p="elemMusic"+c[i].id;if(c[i].picurl){c[i].picurl=c[i].picurl.replace(bH,"")}if(c[i].picurl){var q=bH+c[i].picurl}else{var q="";if(c[i].RoomType==4){q="http://i.vr100.com/intest/AppUI3/images/svg/toilet.svg"}else{if(c[i].RoomType==5){q="http://i.vr100.com/intest/AppUI3/images/svg/liftL.svg"}else{if(c[i].RoomType==6){q="http://i.vr100.com/intest/AppUI3/images/svg/liftB.svg"}else{if(c[i].RoomType==7){q="http://i.vr100.com/intest/AppUI3/images/svg/lift.svg"}else{if(c[i].RoomType==8){q="http://i.vr100.com/intest/AppUI3/images/svg/service.svg"}else{if(c[i].RoomType==9){q="http://i.vr100.com/intest/AppUI3/images/svg/exit.svg"}else{if(c[i].RoomType==10){q="http://i.vr100.com/intest/AppUI3/images/svg/exit.svg"}else{if(M.iconUrl){if(M.iconUrl.indexOf("http")>=0){q=M.iconUrl
}else{q=bH+M.iconUrl}}}}}}}}}if(q==""){q=bH+"/intest/AppUI3/images/svg/music.svg"}}var r={id:p,x:f,y:g,r:1,text:"",width:3,height:3,href:q};this.createSignMarker(r,"group_Elements");this.scaleNaviElemReal(bG)}};G.hideElemByScale=function(a){try{var b=bx.length;for(var i=0;i<b-1;i++){var c=bx[i].pos;var d=c.split(" ");var f=d[0];var g=d[1];for(var j=i+1;j<b;j++){var h=bx[j].id;var k=bx[j].pos;var l=k.split(" ");var m=l[0];var n=l[1];var L=Math.sqrt((f-m)*(f-m)+(g-n)*(g-n));var o=L/bG;if(o<15){document.getElementById("elemText_"+h).style.display="none";document.getElementById("elemMusic"+h).style.display="none"}else{document.getElementById("elemText_"+h).style.display="block";document.getElementById("elemMusic"+h).style.display="block"}}}}catch(e){}};G.setBuildingElements=function(a){by=null;var b=eval("("+a+")");by=b;bz=new Array()};G.showSearchElements=function(a){this.clearElements("group_searchElem");var b=Z.getElementById("group_searchElem");if(!b){var b=document.createElementNS(bb,"g");b.id="group_searchElem";b.style.zIndex=101;ba.appendChild(b)}var c=eval("("+bl+")");var d=c.length;for(var i=0;i<d;i++){var e=c[i].POS.split(" ");var f=parseFloat(e[0]);var g=parseFloat(e[1]);var h=f-2;var j=g-2;var k=f-4;var l=g-8;var m=c[i].id;var n=document.createElementNS(bb,"image");n.href.baseVal=bH+c[i].icon;n.id="searchElem_"+m;n.setAttribute("preserveAspectRatio","xMinYMin meet");$(n).attr("x",h).attr("y",j).attr("x0",f).attr("y0",g).attr("width",4).attr("height",4);b.appendChild(n);var n=document.createElementNS(bb,"image");n.href.baseVal=bH+"/intest/AppUI3/images/svg/sign.svg";n.id="searchElemSign_"+m;n.setAttribute("preserveAspectRatio","xMinYMin meet");$(n).attr("x",k).attr("y",l).attr("x0",f).attr("y0",g).attr("width",8).attr("height",8);b.appendChild(n)}this.scaleNaviElemReal(bG)};G.clearElements=function(a){var b=Z.getElementById(a);if(b){while(b.firstChild){b.removeChild(b.firstChild)}}};G.clearFocusCircle=function(){var a=Z.getElementById("group_focuselement");if(a){while(a.firstChild){a.removeChild(a.firstChild)}}};G.cancelSelected=function(){if(bd==-1){return}for(var a=0,len=bc.length;a<len;a++){var b=bc[a];if(b.id==bd){var c=Z.getElementById(bd);$(c).attr("fill","#c0c0c0");break}}bd=-1};G.turnToSearch=function(a){if(a){document.getElementById("divSearch").style.display="block"}else{document.getElementById("divSearch").style.display="none"}};G.searchChange=function(e,f,g){var h=e;bl=e;var j=h.length;if(f!=""){var k="";for(var i=0;i<j;i++){if(h[i].RoomNumber==null){h[i].RoomNumber=""}var l=h[i].SSID;var m="<span class='color'>"+f+"</span>";l=l.replace(f,m);k=k+"<li  id='indoortomap_searchList_"+h[i].id+"'  elemid='"+h[i].id+"' elempos='"+h[i].POS+"' elemfloorid='"+h[i].FloorId+"'  ><a   >"+l+" <span class='number'>"+h[i].RoomNumber+"</span><span class='floor'>"+h[i].FloorNumber+"F层</span></a></li>"}k+="";document.getElementById("div_SearchResult").innerHTML=k;for(var i=0;i<j;i++){$("#indoortomap_searchList_"+h[i].id).on("click",function(a){var b=$("#"+this.id).attr("elemid");var c=$("#"+this.id).attr("elempos");var d=$("#"+this.id).attr("elemfloorid");G.showFloorElm(""+b+"",""+c+"",""+d+"");G.showDetail(true);G.callAjaxFunc("showDetailInfo","'"+b+"'");G.showNavi(false)})}}if(g){this.showSearchElements(g)}};G.searchChangePromp=function(a){var b=eval("("+a+")");bl=a;var c=b.length;var d="";for(var i=0;i<c;i++){if(b[i].RoomNumber==null){b[i].RoomNumber=""}d=d+"<dl><a  onclick='showFloorElm(\""+b[i].id+'","'+b[i].POS+'","'+b[i].FloorId+'");showDetail(true);this.callAjaxFunc("showDetailInfo","'+b[i].id+"\");showNavi(false);return false;'>"+b[i].SSID+"</a>  <span onclick='naviToElem(\""+b[i].id+'","'+b[i].POS+'","'+b[i].FloorNumber+"\");showNavi(true);showDetail(false);'>到这里</span>  <span>"+b[i].FloorNumber+"F-"+b[i].RoomNumber+"</span><div><img src='"+b[i].picurl+"'  onclick='showFloorElm(\""+b[i].id+'","'+b[i].POS+'","'+b[i].FloorId+'");showDetail(true);this.callAjaxFunc("showDetailInfo","'+b[i].id+"\");showNavi(false);return false;'><p>"+b[i].activeDesc+"</p></div></dl>"}d+="";document.getElementById("div_SearchResult").innerHTML=d};G.showElemType=function(a){var b=eval("("+a+")");var c=b.length;var d="<table width='100%'>";for(var i=0;i<c;i++){if(i%5==0){d+="<tr>"}d=d+"<td><a  onclick='xajax_searchElemList(\""+b[i].id+'","shop");return false;\'><img src="'+b[i].icon+"\" width='48' height='48'><br/>"+b[i].name+"</a>  </td>";if(i%5==4){d+="</tr>"}}d+="</table>";document.getElementById("div_SearchResult").innerHTML=d};G.setBlueColor=function(a,b){var c=$(".public-list li  ");for(var i=0;i<c.length;i++){var d=c[i].id;if(d==("liPub_"+a+"")){var e=c[i].className;if(e.indexOf("bluecolor")>=0){$(c[i]).removeClass("bluecolor");bs=-1;this.clearElements("group_searchElem")}else{$(c[i]).addClass("bluecolor");this.searchElemPub(a)}}else{$(c[i]).removeClass("bluecolor")}}};G.floorChange=function(a){var b=eval("("+a+")");var c=b.length;var d="";for(var i=0;i<c;i++){d=d+"<li  onclick='showFloor(\""+b[i].id+"\");return false;'><span width='70%'><a href='' onclick='return false;'><img src='http://i.vr100.com/intest/AppUI/images/next_btn02.png'></a></span><a href='' onclick='return false;'><b>F"+b[i].FloorNumber+"</b>"+b[i].FloorName+"</a></li>"
}d+="";document.getElementById("div_FloorResult").innerHTML=d};G.signElem=function(a,b){createFocusCircle(a,b);signTap2(b);turnToSearch(false)};G.naviToElem=function(a,b,c){var d=b.split(" ");var z=(c-1)*4;var e=new Array(d[0],d[1],z);this.callAjaxFunc("computePath",bh[0],bh[1],bh[2],e[0],e[1],e[2]);this.turnToSearch(false)};G.naviToPos=function(x,y,z){var a=new Array(parseFloat(x),parseFloat(y),parseFloat(z));this.showDetail(false);this.showNavi(true);this.setToMyPos(true);var b=a[2]/4+1;detail_FloorNumber=b;detail_pos=a[0]+" "+a[1];document.getElementById("div_DetailContent").innerHTML="";document.getElementById("div_DetailPop").innerHTML="";this.callAjaxFunc("computePath",bh[0],bh[1],bh[2],a[0],a[1],a[2]);this.turnToSearch(false)};G.naviBetweenPos=function(a,b,c,d,e,f){this.callAjaxFunc("computePath",a,b,c,d,e,f,true)};G.computePath=function(x,y,z,a,b,c){this.callAjaxFunc("computePath",x,y,z,a,b,c)};G.naviToElemById=function(a){xajax_naviToElemById(bh[0],bh[1],bh[2],a)};G.setTempDetial=function(a,b,c){bX=a;detail_pos=b;detail_FloorNumber=c};G.NaviToDetail=function(){this.playAudio("http://i.vr100.com/intest/audio/common/startNavi.mp3");this.setMusic("http://i.vr100.com/intest/audio/common/startNavi.mp3");$.confirm("是否开始导航",function(a){if(!a){return}else{if(Math.abs(bh[0])+Math.abs(bh[1])<1){$.alert("等待定位中...",2000);G.reNavigate()}else{G.showDetail(false);G.showNavi(true);G.setToMyPos(true);G.naviToElem(bX,detail_pos,detail_FloorNumber)}}})};G.reNavigate=function(){if(Math.abs(bh[0])+Math.abs(bh[1])<1){this.showDetail(false);this.showNavi(true);this.setToMyPos(true);this.naviToElem(bX,detail_pos,detail_FloorNumber)}else{this.showDetail(false);this.showNavi(true);this.setToMyPos(true);this.naviToElem(bX,detail_pos,detail_FloorNumber)}};G.showFloorElm=function(a,b,c){this.setToMyPos(false);if(c!=bg){this.loadElemsFloor(a,"");this.loadMap(a,"")}else{this.showFloorAndElem("","","",a,b,c)}this.turnToSearch(false)};G.showFloor=function(a){this.setToMyPos(false);if(a!=bg){this.loadElemsFloor("",a);this.loadMap("",a);this.searchElemPub(bs)}};G.DrawPath=function(a,b){G.clearPath("group_Path");var c=eval("("+a+")");ch=c;var d=c.length;var e="";bC=new Array();bD=new Array();var j=0;var f=null;for(var i=0;i<d;i++){if(i==0){e=e+"M"+c[i]["pos"][0]+","+c[i]["pos"][1]}else{e=e+" L"+c[i]["pos"][0]+","+c[i]["pos"][1]}if(i<d-1){if(c[i]["pos"][2]!=c[i+1]["pos"][2]){var g={id:"pt_stair",x:c[i]["pos"][0],y:c[i]["pos"][1],r:1,text:"楼梯",width:3,height:3,href:bH+"/intest/images/elem/stair.svgz"};G.createSignMarker(g,"group_Path")}}}var h=Z.getElementById("group_Path");if(!h){var h=document.createElementNS(bb,"g");h.id="group_Path";h.style.zIndex=100;ba.appendChild(h)}var k="#efefef";if(b!=null){k="#00ee22"}else{G.drawTempFloorRoad();bZ=true}var l=$(document.createElementNS(bb,"path"));l.attr("pointer-events","none");l.attr("fill","white").attr("fill-opacity","0").attr("stroke",k).attr("stroke-width",2.2).attr("stroke-linejoin","round").attr("stroke-dasharray",2.5,2.5).attr("id","path_navi").attr("Pointer-event","none");l.appendTo($(h));l.attr("d",e);var m={id:"pt_start",x:c[0]["pos"][0],y:c[0]["pos"][1],r:1,text:"起",width:8,height:8,href:"http://i.vr100.com/intest/images/elem/from.svgz"};G.createSignMarker(m,"group_Path");var n={id:"pt_end",x:c[d-1]["pos"][0],y:c[d-1]["pos"][1],r:1,text:"终",width:8,height:8,href:"http://i.vr100.com/intest/images/elem/to.svgz"};G.createSignMarker(n,"group_Path");G.scaleNaviElemReal(bG)};G.DrawPathShow=function(a,b){G.clearPath("group_Path");var c=eval("("+a+")");ch=c;var d=c.length;var e="";bC=new Array();bD=new Array();var j=0;var f=null;for(var i=0;i<d;i++){if(i==0){e=e+"M"+c[i]["pos"][0]+","+c[i]["pos"][1]}else{e=e+" L"+c[i]["pos"][0]+","+c[i]["pos"][1]}if(i<d-1){if(c[i]["pos"][2]!=c[i+1]["pos"][2]){var g={id:"pt_stair",x:c[i]["pos"][0],y:c[i]["pos"][1],r:1,text:"楼梯",width:3,height:3,href:bH+"/intest/images/elem/stair.svgz"};G.createSignMarker(g,"group_Path")}}}var h=Z.getElementById("group_Path");if(!h){var h=document.createElementNS(bb,"g");h.id="group_Path";h.style.zIndex=100;ba.appendChild(h)}var k=$(document.createElementNS(bb,"path"));k.attr("pointer-events","none");k.attr("fill","white").attr("fill-opacity","0").attr("stroke","#00ee22").attr("stroke-width",2.2).attr("stroke-linejoin","round").attr("stroke-dasharray",2.5,2.5).attr("id","path_navi").attr("Pointer-event","none");k.appendTo($(h));k.attr("d",e);var l={id:"pt_start",x:c[0]["pos"][0],y:c[0]["pos"][1],r:1,text:"起",width:8,height:8,href:"http://i.vr100.com/intest/images/elem/from.svgz"};G.createSignMarker(l,"group_Path");var m={id:"pt_end",x:c[d-1]["pos"][0],y:c[d-1]["pos"][1],r:1,text:"终",width:8,height:8,href:"http://i.vr100.com/intest/images/elem/to.svgz"};G.createSignMarker(m,"group_Path");G.scaleNaviElemReal(bG)};G.drawTempFloorRoad=function(a){try{this.clearPath("group_PathTemp");var b=new Array();var c=ch.length;var d="";var j=0;for(var i=0;i<c;i++){var f=ch[i]["pos"][2];var g=bh[2];if(a>=0){g=a}else{g=bh[2]}if(f==g){b.push(ch[i]["pos"]);
if(j==0){d=d+"M"+ch[i]["pos"][0]+","+ch[i]["pos"][1]}else{d=d+" L"+ch[i]["pos"][0]+","+ch[i]["pos"][1]}j++}}var h=Z.getElementById("group_PathTemp");if(!h){var h=document.createElementNS(bb,"g");h.id="group_PathTemp";h.style.zIndex=101;ba.appendChild(h)}var k=Z.getElementById("group_MarkerArrow");if(!k){var k=document.createElementNS(bb,"g");k.id="group_MarkerArrow";k.style.zIndex=120;ba.appendChild(k);$("#group_MarkerArrow").html('<marker id="markerArrow" markerWidth="13" markerHeight="13" refx="2" refy="6" orient="auto">  <image  x="1" y="5.0" width="2" height="2" xlink:href="http://i.vr100.com/intest/images/elem/arrow.svg"  preserveAspectRatio="xMinYMin meet" />  </marker>   ')}var l=$(document.createElementNS(bb,"path"));l.attr("fill","white").attr("fill-opacity","0").attr("stroke","#ff2200").attr("stroke-width",2.2).attr("stroke-linejoin","round").attr("stroke-dasharray",2.5,2.5).attr("id","path_naviTemp").attr("Pointer-event","none").attr("marker-mid","url(#markerArrow)");l.appendTo($(h));l.attr("d",d);l.attr("pointer-events","none");if(a>=0){}}catch(e){}};G.clearPath=function(a){var b=Z.getElementById(a);if(b){while(b.firstChild){b.removeChild(b.firstChild)}}};G.setRealPosWeb=function(x,y,a,b,c){var d=parseFloat(a-1)*4;bh=new Array(x,y,d,c);this.DrawPos();bw=true;var f={"x":x,"y":y,"z":d,"FloorNumber":a};G.exeCallBack("getRealPos",f);var g=JSON.stringify(f);try{this.setParam("getRealPos",g)}catch(e){}};G.computeAllPath=function(a){bk=a;cj=0;ci=new Array();ck=new Array();var b=eval("("+bk+")");var c=b.length;for(var i=0;i<c-1;i++){var d=b[i].pos;var e=b[i+1].pos;var f=d[0];var g=d[1];var h=d[2];var j=e[0];var k=e[1];var l=e[2];var m=Math.sqrt((f-j)*(f-j)+(g-k)*(g-k)+(h-l)*(h-l));ci[i]=m;cj+=m}var n=Math.floor(cj);var o="";if(M.layerNumber>=1){o=M.layerNumber+"层。"}var p="";var q=document.getElementById("div_DetailPop").innerHTML;if(q!=""){p="<br/>标牌：["+q+"]"}var r=0;if(detail_FloorNumber<1){r=detail_FloorNumber-1}else{r=detail_FloorNumber}document.getElementById("pathAll").innerHTML="请到"+r+"楼，"+"目标位于："+document.getElementById("div_DetailContent").innerHTML+p;var s=parseInt(bh[2]/4)+1;var t=(detail_FloorNumber-1)*4;var u="";var v="";var w=0;if(s<1){w=s-1}else{w=s}if(s!=detail_FloorNumber){u="&nbsp;你当前在"+w+"楼,请先到"+detail_FloorNumber+"楼，然后沿路径行走";v="<a onclick='setFloorClickByFloorNumber("+s+");drawTempFloorRoad("+bh[2]+")'>>当前线路</a>"+"&nbsp;&nbsp;<a onclick='setFloorClickByFloorNumber("+detail_FloorNumber+");drawTempFloorRoad("+t+")'>>目标线路</a>";document.getElementById("DivFloorNumber").innerHTML=v}else{u="&nbsp;你当前在"+w+"楼,请沿路径行走到目标"}document.getElementById("div_DetailContent").innerHTML=document.getElementById("div_DetailContent").innerHTML+u};G.registerSetWordCallback=function(a){cx=a};G.setWord=function(a){if(cx){cx(a)}try{JSSpeak.speakNavi(a)}catch(e){}};G.registerSetMusicCallback=function(a){cy=a};G.setMusic=function(a){if(cy){cy(a)}try{WebJS.setMusic(a)}catch(e){}};G.setNaviToPark=function(a){naviToElemById(a)};G.setNaviToParkAuto=function(a){this.callAjaxFunc("showDetailInfo",a)};G.setMaxUUID=function(a){var b=parseInt(a.substring(0,8));if(b>0){if(J!=b){if(cr==true||cs==true){cs=false;cr=false}}}};G.setByMM=function(a){var b=a.rssi;if(b==0||b==-1){b=-99}var c=ct.length;var d=false;var e=a.uuid+"_"+a.major+"_"+a.minor;for(var n=0;n<c;n++){if(ct[n].rssimm==e){var m=parseInt(ct[n].nums);ct[n].rssi=(parseInt(ct[n].rssi)*m+parseInt(b))/(m+1);ct[n].nums=m+1;d=true}}if(d==false){var f={uuid:a.uuid,rssi:b,rssimm:e,major:a.major,minor:a.minor,nums:1};ct.push(f)}};G.setByMMStop=function(a){var b=a.rssi;if(b==0||b==-1){b=-99}var c=cu.length;var d=false;var e=a.uuid+"_"+a.major+"_"+a.minor;for(var n=0;n<c;n++){if(cu[n].rssimm==e){var m=parseInt(cu[n].nums);cu[n].rssi=(parseInt(cu[n].rssi)*m+parseInt(b))/(m+1);cu[n].nums=m+1;d=true}}if(d==false){var f={uuid:a.uuid,rssi:b,rssimm:e,major:a.major,minor:a.minor,nums:1};cu.push(f)}};G.obj2string=function(o){var r=[];if(typeof o=="string"){return'"'+o.replace(/([\'\"\\])/g,"\\$1").replace(/(\n)/g,"\\n").replace(/(\r)/g,"\\r").replace(/(\t)/g,"\\t")+'"'}if(typeof o=="object"){if(!o.sort){for(var i in o){r.push(i+":"+obj2string(o[i]))}if(!!document.all&&!/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(o.toString)){r.push("toString:"+o.toString.toString())}r="{"+r.join()+"}"}else{for(var i=0;i<o.length;i++){r.push(obj2string(o[i]))}r="["+r.join()+"]"}return r}return o.toString()};G.setScanIbeacon=function(a){var b;if(cq.plant=="iPhone"){var c=eval("("+a+")");b=c.ibeacons;var d=b.length;for(var i=0;i<d;i++){var e=parseInt(b[i].rssi);if(e>=-20&&e<=0){b[i].rssi=-99}}}else{a=a.replace(/_1/g,"{");a=a.replace(/_2/g,"}");a=a.replace(/:1\+/g,':"');a=a.replace(/\+2/g,'"');strTo=a.replace(/\+/g,"");var c=eval("("+strTo+")");b=c.ibeacons;var d=b.length;for(var i=0;i<d;i++){var e=parseInt(b[i].rssi);if(e>=-20&&e<=0){b[i].rssi=-99}b[i].uuid=b[i].uuid.toUpperCase()}}this.setTempBox(b)};G.cpPos=function(a){this.setTempBox(a)};G.setTempBox=function(a){var b=a.length;
if(b==0){return}var c="";for(var i=0;i<b;i++){c+="rssi2:"+parseInt(a[i].rssi)+",minor:"+a[i].minor+"<br/>"}var d="";for(var i=0;i<b;i++){d="";d=a[i].uuid+"_"+a[i].major+"_"+a[i].minor;var f=this.findMacPos(d);if(f!=null){var g=a[i];this.setByMM(g);this.setByMMStop(g)}}if(bK==true){G.computePos()}if(cF==false){G.computePos()}G.exeCallBack("scanInfo",a);var h=JSON.stringify(a);try{this.setParam("scanInfo",h)}catch(e){}};G.computePos=function(){var a=ct.length;if(a>=1){bP=true}else{ct=Array();bP=false;return}if(a>3){a=3}var X=Array();var Y=Array();var b=0;var c=0;var f=Array();var d=Array();var g=Array();var h=Array();var j=0;ct.sort(G.by("rssi"));var k="";for(var i=0;i<a;i++){k+="rssi4:"+parseInt(ct[i].rssi)+",minor:"+ct[i].minor+"<br/>"}if(ct[0].rssi<cC&&(Math.abs(bh[0])+Math.abs(bh[1])>1)){ct=Array();k+="<font color='red'>return!</font><br/>";if(G.getUrlParam("debug")==1){$.alert(k,2000)}return}var l="";for(var i=0;i<a;i++){l="";l=ct[i].uuid+"_"+ct[i].major+"_"+ct[i].minor;var m=G.findMacPos(l);var n=m.POS.split(" ");if(n.length!=2){return}X.push(parseFloat(n[0]));Y.push(parseFloat(n[1]));var o=parseInt(ct[i].rssi);var p=101+o;g[i]=p}for(var i=0;i<a;i++){b=b+(X[i]/a);c=c+(Y[i]/a)}for(var i=0;i<a;i++){var q=g[i]-g[a-1]*0.9;f.push(q);var r=Math.pow(q,2);d.push(r);j=j+d[i]}var s=b;var t=c;for(var i=0;i<a;i++){h.push(d[i]/j);s=s+((X[i]-b)*h[i]);t=t+((Y[i]-c)*h[i])}try{var u=parseFloat(bQ[0]);var v=parseFloat(bQ[1]);var w=S.firstChild.getAttribute("cx");var x=S.firstChild.getAttribute("cy");dx=(u-w);dy=(v-x);xx=Math.pow(dx,2);yy=Math.pow(dy,2);R=Math.sqrt(xx+yy);var y=0;if(cq.iswx=="true"&&cq.plant!="iPhone"){y=0}else{y=cE*0.25}if(R>=y&&(ct[0].rssi>cC+4)){if(bO==true){bN=true;bO=false}if(Math.abs(s)+Math.abs(t)<0.1){return}bR[0]=s;bR[1]=t;G.toPosPath();bM[0]=s;bM[1]=t;cc=0;cd=0;ct=Array();k+="<font color='green'>REST DATA!</font><br/>";if(G.getUrlParam("debug")==1){$.alert(k,2000)}}}catch(e){}var z=G.findMacPos(l);var A=z.FloorNumber;var B=z.BuildingId;var C=z.FloorId;G.setRealPosWeb(s,t,A,B,C);ct=Array()};G.computePosStop=function(){if(bK==true&&G.getUrlParam("debug")==1){$.alert("<font color='#330000'>return</font>",2000);return}var a=cu.length;if(a<1){cu=Array();return}if(a>4){a=4}var X=Array();var Y=Array();var b=0;var c=0;var f=Array();var d=Array();var g=Array();var h=Array();var j=0;cu.sort(G.by("rssi"));var k="";for(var i=0;i<a;i++){k+="rssi1--:"+parseInt(cu[i].rssi)+",minor:"+cu[i].minor+"<br/>"}if(cu[0].rssi<cC-4&&(Math.abs(bh[0])+Math.abs(bh[1])>1)){cu=Array();k+="<font color='#770000'> Return AVA</font><br/>";if(G.getUrlParam("debug")==1){$.alert(k,2000)}return}var l="";for(var i=0;i<a;i++){l="";l=cu[i].uuid+"_"+cu[i].major+"_"+cu[i].minor;var m=G.findMacPos(l);var n=m.POS.split(" ");if(n.length!=2){return}X.push(parseFloat(n[0]));Y.push(parseFloat(n[1]));var o=parseInt(cu[i].rssi);var p=101+o;g[i]=p}for(var i=0;i<a;i++){b=b+(X[i]/a);c=c+(Y[i]/a)}for(var i=0;i<a;i++){var q=g[i]-g[a-1]*0.9;f.push(q);var r=Math.pow(q,2);d.push(r);j=j+d[i]}var s=b;var t=c;for(var i=0;i<a;i++){h.push(d[i]/j);s=s+((X[i]-b)*h[i]);t=t+((Y[i]-c)*h[i])}try{var u=parseFloat(bQ[0]);var v=parseFloat(bQ[1]);var w=S.firstChild.getAttribute("cx");var x=S.firstChild.getAttribute("cy");dx=(u-w);dy=(v-x);xx=Math.pow(dx,2);yy=Math.pow(dy,2);R=Math.sqrt(xx+yy);var y=0;if(cq.iswx=="true"&&cq.plant!="iPhone"){y=0}else{y=cE*0.25}if(R>=y&&(cu[0].rssi>cC-4)){if(bO==true){bN=true;bO=false}if(Math.abs(s)+Math.abs(t)<0.1){return}bR[0]=s;bR[1]=t;G.toPosPath();bM[0]=s;bM[1]=t;cc=0;cd=0;cu=Array();k+="<font color='blue'>Avarge set!</font><br/>";if(G.getUrlParam("debug")==1){$.alert(k,2000)}}}catch(e){}var z=G.findMacPos(l);var A=z.FloorNumber;var B=z.BuildingId;var C=z.FloorId;G.setRealPosWeb(s,t,A,B,C);cu=Array()};G.by=function(c){return function(o,p){var a,b;if(typeof o==="object"&&typeof p==="object"&&o&&p){a=parseInt(o[c]);b=parseInt(p[c]);if(a===b){return 0}if(typeof a===typeof b){return a<b?1:-1}return typeof a<typeof b?1:-1}else{throw ("error2")}}};G.findMacPos=function(a){var b=null;try{var c=bJ.length;for(var i=0;i<c;i++){if(bJ[i].SSIDMM==a){b=bJ[i]}}}catch(e){}return b};G.setFloorClickByFloorNumber=function(a){if(a==1){setFloorClick(9);this.loadMap("",9)}else{if(a==2){setFloorClick(31);this.loadMap("",31)}else{if(a==3){setFloorClick(7);this.loadMap("",7)}}}};G.setPop=function(a){bI=a};G.DrawPos=function(a){cl[0]=parseFloat(bh[0]);cl[1]=parseFloat(bh[1]);var b=parseInt(bh[3]);if(bg!=b){if(bi){this.loadElemsFloor("",b);this.loadMap("",b);this.setFloorClick(b);this.drawTempFloorRoad(bh[2]);G.scaleNaviElemReal(bG)}}var c=Z.getElementById("group_MyPos");if((!c)&&(cl[0])){bM[0]=bh[0];bM[1]=bh[1];bR[0]=bh[0];bR[1]=bh[1];this.createGroup_MyPos("group_MyPos",cl[0],cl[1]);this.createGroup_MyPos2("group_MyPos2",cl[0],cl[1]);this.createGroup_MyPos3("group_MyPos3",cl[0],cl[1]);G.exeCallBack("isLoacate","1");try{this.setParam("isLoacate","1")}catch(e){}}};G.createGroup_MyPos=function(a,b,c){P=document.createElementNS(bb,"g");P.id=a;P.style.zIndex=100;ba.appendChild(P);
var d=$(document.createElementNS(bb,"circle"));var e="1001";var r=0.0013;d.attr("id",e).attr("cx",b).attr("cy",c).attr("r",r).attr("fill","#000eff");d.appendTo($(P));if(cm==false){cm=true;setInterval(G.walkTo,100);if(cq.iswx!="true"||cq.plant=="iPhone"){setInterval(G.walkToStep,400)}setInterval(G.walkSide,100)}};G.createGroup_MyPos3=function(a,b,c){S=document.createElementNS(bb,"g");S.id=a;S.style.zIndex=100;ba.appendChild(S);var d=$(document.createElementNS(bb,"circle"));var e="1003";var r=0.0006;d.attr("id",e).attr("cx",b).attr("cy",c).attr("r",r).attr("fill","#000eff");d.appendTo($(S));T=document.createElementNS(bb,"g");T.id="group_MyPosVert";T.style.zIndex=100;ba.appendChild(T);var d=$(document.createElementNS(bb,"circle"));var e="1004";var r=0.0006;d.attr("id",e).attr("cx",b).attr("cy",c).attr("r",r).attr("fill","#ff0e00");d.appendTo($(T))};G.createGroup_MyPos2=function(a,b,c){Q=document.createElementNS(bb,"g");Q.id=a;Q.style.zIndex=100;ba.appendChild(Q);var d=document.createElementNS(bb,"image");d.id="sign_myPos";d.href.baseVal=bH+"/intest/AppUI3/images/mypos_indoor.svg";d.setAttribute("preserveAspectRatio","xMinYMin meet");bY=bG*20;$(d).attr("x",b).attr("y",c).attr("x0",b).attr("y0",c).attr("width",bY).attr("height",bY);Q.appendChild(d)};G.walkTo=function(){if(cl[0]){if(P){var a=P.firstChild.getAttribute("cx");var b=P.firstChild.getAttribute("cy");var c=cl[0];var d=cl[1];dx=(c-a);dy=(d-b);xx=Math.pow(dx,2);yy=Math.pow(dy,2);R=Math.sqrt(xx+yy);vx=dx/R;vy=dy/R;var e=R/2;var f=new Array();if(a==c&&c!=0){f[0]=c;f[1]=d}else{f[0]=parseFloat(vx*e)+parseFloat(a);f[1]=parseFloat(vy*e)+parseFloat(b)}if(f[0]){bU=bU+f[0];bV=bV+f[1];bW++;P.firstChild.setAttribute("cx",f[0]);P.firstChild.setAttribute("cy",f[1]);bQ[0]=f[0];bQ[1]=f[1];var g=S.firstChild.getAttribute("cx");var h=S.firstChild.getAttribute("cy");if(bi==true){G.setViewByPos(g+" "+h);if(bo){ba.setAttributeNS(null,"transform","rotate("+(0-U)+","+bQ[0]+","+bQ[1]+")");ba.setAttributeNS(null,"transform","rotate("+(0)+","+0+","+0+")")}else{ba.setAttributeNS(null,"transform","rotate("+(0)+","+0+","+0+")")}}if(document.getElementById("div_Navi").style.display=="none"){G.computeNearElem(g,h,bh[2])}else{G.computeVoice(f[0],f[1],bh[2])}}}}};G.walkToStep=function(){if(bN){var a=cc+parseFloat(bM[0]);var b=cd+parseFloat(bM[1]);if(Math.abs(a)+Math.abs(b)<0.1){return}bR[0]=a;bR[1]=b;G.toPosPath()}};G.toPosPath=function(){var a=bR[0];var b=bR[1];if(bT&&bo){var c=eval("("+bk+")");var e=c.length;var f=1000000000000;var g=null;var h=null;var j=-1;var l=1000000000000;for(var i=0;i<e;i++){var m=c[i].pos;var n=m[0];var o=m[1];var p=m[2];if(p==bh[2]){var q=a-n;var r=b-o;var d=Math.sqrt(q*q+r*r);if(d<l){l=d;j=i}}}if(j==0){j=1}if(j==e-1){j=e-2}var s;var t;for(var i=j-1;i<j+1;i++){var m=c[i].pos;var n=m[0];var o=m[1];var p=m[2];var u=c[i+1].pos;var v=u[0];var w=u[1];var z=u[2];var A=w-o;var B=n-v;var C=(v*o)-(n*w);var d=(A*a+B*b+C)/Math.sqrt((A*A)+(B*B));d=Math.abs(d);var k=((a-n)*(v-n)+(b-o)*(w-o))/((v-n)*(v-n)+(w-o)*(w-o));var x=parseFloat(n)+k*(v-n);var y=parseFloat(o)+k*(w-o);var D=((x-n)*(v-x)>=0)&&((y-o)*(w-y)>=0);if(d<f&&D){f=d;g=m;h=u;s=x;t=y}}if(s&&t){bS[0]=s;bS[1]=t}}};G.walkSide=function(){var a=S.firstChild.getAttribute("cx");var b=S.firstChild.getAttribute("cy");if(!bR[0]){return}var c=bR[0];var d=bR[1];if(Math.abs(c)+Math.abs(d)<1){return}var e=(c-a);var f=(d-b);var g=Math.pow(e,2);var h=Math.pow(f,2);var R=Math.sqrt(g+h);var i=e/R;var j=f/R;if(R<0.2){if(bT&&bo){Q.setAttributeNS(null,"transform","rotate("+V+","+bS[0]+","+bS[1]+")");Q.firstChild.setAttribute("x0",bS[0]);Q.firstChild.setAttribute("y0",bS[1])}else{Q.setAttributeNS(null,"transform","rotate("+V+","+a+","+b+")");Q.firstChild.setAttribute("x0",a);Q.firstChild.setAttribute("y0",b)}return}var k=R/10;var l=new Array();if(a==c&&c!=0){l[0]=c;l[1]=d}else{l[0]=parseFloat(i*k)+parseFloat(a);l[1]=parseFloat(j*k)+parseFloat(b)}if(l[0]){S.firstChild.setAttribute("cx",l[0]);S.firstChild.setAttribute("cy",l[1]);if(bT&&bo){T.firstChild.setAttribute("cx",bS[0]);T.firstChild.setAttribute("cy",bS[1]);var m=parseFloat(bS[0])-(bG*12);var n=parseFloat(bS[1])-(bG*12);Q.firstChild.setAttribute("x",m);Q.firstChild.setAttribute("y",n);Q.firstChild.setAttribute("x0",m);Q.firstChild.setAttribute("y0",n);Q.setAttributeNS(null,"transform","rotate("+V+","+bS[0]+","+bS[1]+")")}else{var m=parseFloat(l[0])-(bG*12);var n=parseFloat(l[1])-(bG*12);Q.firstChild.setAttribute("x",m);Q.firstChild.setAttribute("y",n);Q.firstChild.setAttribute("x0",m);Q.firstChild.setAttribute("y0",n);Q.setAttributeNS(null,"transform","rotate("+V+","+l[0]+","+l[1]+")")}}else{}};G.computeVoice=function(a,b,c){if(!bk){return}var d=eval("("+bk+")");var e=d.length;var f=100000000;var g=-1;for(var i=0;i<e;i++){var h=d[i].pos;var j=h[0];var k=h[1];var l=h[2];var m=Math.sqrt((j-a)*(j-a)+(k-b)*(k-b)+(l-c)*(l-c));if(m<f){f=m;g=i}}if(e>=1){var n=d[e-1].pos[0];var o=d[e-1].pos[1];var p=d[e-1].pos[2];var q=Math.sqrt((n-a)*(n-a)+(o-b)*(o-b)+(p-c)*(p-c));var r=M.realWidth*0.05;
if(q<r&&bZ==true){this.showNavi(false);$.alert("您已到达目的地，本次导航结束",3000);this.playAudio("http://i.vr100.com/intest/audio/common/end.mp3")}}var s=this.contains(ck,g);var t=bq*0.1;if(t>6){t=6}else{if(t<2){t=2}}if(f<t){if(s){return}var u=d[g].type;var v=d[g].hint;var w=d[g+1].type;var x=d[g+1].hint;var y="";if(v!=""){y+="当前位置"+v+"，"+u+"，"}else{y+=u;if(u=="左转"){this.playAudio("http://i.vr100.com/intest/audio/common/turnleft.mp3")}else{if(u=="右转"){this.playAudio("http://i.vr100.com/intest/audio/common/turnright.mp3")}}}if(u=="上楼"||u=="下楼"){y+=u;if(u=="上楼"){this.playAudio("http://i.vr100.com/intest/audio/common/upstairs.mp3")}else{if(u=="上楼"){this.playAudio("http://i.vr100.com/intest/audio/common/downstairs.mp3")}}}if(x!=""){var z=Math.floor(ci[g])}else{}document.getElementById("naviWord").innerHTML=y;ck.push(g)}};G.computeNearElem=function(a,b,c){var d=by.length;if(d<1){return}var e=100000;var f=-1;for(var i=0;i<d;i++){var g=by[i].pos3d;var h=g[0];var j=g[1];var k=g[2];var l=by[i].isactive;if(l==1&&k==c){var m=Math.sqrt((h-a)*(h-a)+(j-b)*(j-b)+(k-c)*(k-c));if(m<e){e=m;f=i}}}var n=by[f].dispop;if(parseFloat(n)>0.01){}else{n=10}var o=this.contains(bz,f);if(e<n){if(o||by[f].isactive!=1){return}if(by[f].pop=="广告词"){return}var p=""+by[f].pop+"";bz.push(f);var q=bz.length;for(var i=q-1;i>=0;i--){if(bz[i]!=f){bz.splice(i,1)}}var r=by[f].audiourl;this.showPop(by[f].id);var s="http://i.vr100.com/"+r}};G.computeStay=function(){var a=bh[0];var b=bh[1];var c=bh[2];var d=by.length;if(d<1){return}var e=100000;var f=-1;var g=-1;for(var i=0;i<d;i++){var h=by[i].pos3d;var j=h[0];var k=h[1];var l=h[2];var m=Math.sqrt((j-a)*(j-a)+(k-b)*(k-b)+(l-c)*(l-c));if(m<e){e=m;f=i;g=by[i].id}}if(e<10){by[f].staytimes=by[f].staytimes+1;if(by[f].staytimes%30==0){}}};G.contains=function(a,b){var i=a.length;while(i--){if(a[i]===b){return true}}return false};G.setToMyPos=function(a){bi=a;if(a){document.getElementById("icon_dingwei").src=bH+"/intest/AppUI/images/dingwei_my.svgz";if(Math.abs(bh[0]-0)<0.00001){}}else{cp=new Date().getTime();document.getElementById("icon_dingwei").src=bH+"/intest/AppUI3/images/svg/toMyPos.svg"}G.exeCallBack("getMyPosState",bi);try{this.setParam("getMyPosState",bi)}catch(e){}};G.showNavi=function(a){if(a){document.getElementById("div_Navi").style.display="block"}else{document.getElementById("div_Navi").style.display="none";this.clearPath("group_Path");this.clearPath("group_PathTemp");bZ=false}bo=a;bp=!a};G.showDetail=function(a){if(a){document.getElementById("div_Detail").style.display="block"}else{document.getElementById("div_Detail").style.display="none"}bp=a};G.showLoading=function(){var a=document.getElementById("loading");a.style.display="block";setTimeout("closeLoading()",10000)};G.closeLoading=function(){document.getElementById("loading").style.display="none"};G.relogin=function(a){window.open(bH+'/do/login.php"; ?>',"_self")};G.searchPromp=function(){turnSearchIpt(false);xajax_searchPromp(bh)};G.turnSearchIpt=function(a){document.getElementById("div_SearchResult").innerHTML="";if(a){document.getElementById("iptSearch").style.display="block";xajax_searchClass()}else{document.getElementById("iptSearch").style.display="none"}};G.showMe=function(){iFrameHeightUser("showUi")};G.iFrameHeightUser=function(a){var b=getPageInfo(a);var c=document.getElementById(b.pageName);c.height=document.documentElement.clientHeight;c.width=document.documentElement.clientWidth;document.getElementById("div_Content0").style.height=document.documentElement.clientHeight+"px";document.getElementById("div_Content0").style.width=document.documentElement.clientHeight+"px"};G.turnPageUser=function(a,b){var c=getPageInfo(b);if(a){document.getElementById(c.pageDiv).style.display="block"}else{document.getElementById(c.pageDiv).style.display="none"}};G.setReturn=function(){returnLastPage()};G.returnLastPage=function(){hiddeAllPage();top.closeLoading();var a=cw[cw.length-1];if(a=="shopDetail"){turnPageUser(true,"shopDetail")}else{if(a=="shopSearch"){turnPageUser(true,"shopSearch")}else{if(a=="showUi"){}else{try{getAppJump("BigAppIndex","showUi","")}catch(e){}}}}cw.pop()};G.getPageInfo=function(a){var b={pageName:"",pageUrl:"",pageDiv:"",fromtype:""};if(a=="userInfo"){b.pageName="iframepageUserInfo";b.pageUrl="userInfo.php";b.pageDiv="divUserInfo"}else{if(a=="shop"){b.pageName="iframepageShop";b.pageUrl="shop.php";b.pageDiv="divShop"}else{if(a=="showUi"){b.pageName="iframeShowUi";b.pageUrl="showUi.php";b.pageDiv="divShowUi"}else{if(a=="shopDetail"){b.pageName="iframeShopDetail";b.pageUrl="shopDetail.php";b.pageDiv="divShopDetail"}else{if(a=="shopSearch"){b.pageName="iframeShopSearch";b.pageUrl=bH+"/intest/shopSearch.php";b.pageDiv="divShopSearch"}}}}}return b};G.hiddeAllPage=function(){try{document.getElementById("divShopDetail").style.display="none";document.getElementById("divShopSearch").style.display="none"}catch(e){}};G.initShow=function(a,b,c){showLoading();var d=getPageInfo(a);var e=document.getElementById(d.pageName);cv=b;cw.push(b);if(e.src=="about:blank"){if(c){e.src=c
}else{e.src=d.pageUrl}}else{try{var f=e.contentWindow.document.getElementById("myBody")}catch(err1){}if(!f){if(c){e.src=c}else{e.src=d.pageUrl}}else{if(c){e.src=c}else{var g=e.src;var h=g.lastIndexOf("/");var i=g.substring(h+1);if(i!=d.pageUrl){e.src=d.pageUrl}else{turnPageUser(true,a)}}}}};G.showShopPage=function(a,b){var c="";if(a){c=a}else{c=bX}if(!b){b="showUi"}initShow("shopDetail",b,bH+"/intest/shopdetail.php?id="+c);turnPageUser(true,"shopDetail")};G.showContent=function(a){var b="";if(a){b=a}else{b=bX}this.callAjaxFunc("showContent",b)};G.playAudioServ=function(a){var b="";if(a){b=a}else{b=bX}this.callAjaxFunc("playAudioServ",b)};G.showContentPage=function(a){if(a){document.getElementById("div_Introduce").style.display="block"}else{document.getElementById("div_Introduce").style.display="none";document.getElementById("div_Content").innerHTML=""}};G.showPop=function(a){this.callAjaxFunc("showPop",a)};G.vr100Quit=function(){top.quitUser()};G.drawPtReal=function(){var a={enableHighAccuracy:false,timeout:4000,maximumAge:30000};if(g_gpsMatch==null){return}if(navigator.geolocation){if(M.isGPS==1){var b=navigator.geolocation.watchPosition(G.displayPosition,G.handleError,a)}}else{aler("浏览器不支持");H=true}};G.handleError=function(a){H=true};G.displayPosition=function(a){if(bP==false){try{var b=a.coords.longitude;var c=a.coords.latitude;var d=parseFloat(g_p0[0]);var f=parseFloat(g_p0[1]);var g=parseFloat(g_p1[0]);var h=parseFloat(g_p1[1]);var i=parseFloat(g_g0[1]);var j=parseFloat(g_g0[0]);var k=parseFloat(g_g1[1]);var l=parseFloat(g_g1[0]);var m=d+(b-i)*(g-d)/(k-i);var n=f+(c-j)*(h-f)/(l-j);setRealPosWeb(m,n,1,J,M.FloorId);H=false}catch(e){H=true}}else{}};G.displayPositionWX=function(a){if(bP==false){try{var b=a.longitude;var c=a.latitude;var d=parseFloat(g_p0[0]);var f=parseFloat(g_p0[1]);var g=parseFloat(g_p1[0]);var h=parseFloat(g_p1[1]);var i=parseFloat(g_g0[1]);var j=parseFloat(g_g0[0]);var k=parseFloat(g_g1[1]);var l=parseFloat(g_g1[0]);var m=d+(b-i)*(g-d)/(k-i);var n=f+(c-j)*(h-f)/(l-j);setRealPosWeb(m,n,1,J,M.FloorId)}catch(e){}}};G.setConfig=function(a){if(a.objName=="showSearchBar"){$("#searchBarDivR").css("display",a.paraValue)}else{if(a.objName=="showFloorList"){$("#floorListDivR").css("display",a.paraValue)}else{if(a.objName=="showPubList"){$("#pubListDivR").css("display",a.paraValue)}else{if(a.objName=="showDetail"){$("#detailDivR").css("display",a.paraValue)}else{if(a.objName=="showNavi"){$("#naviDivR").css("display",a.paraValue)}}}}}};G.exeCallBack=function(a,b){for(var p in cz){if(p==a){a=cz[p];eval(a)(b)}}};G.registerFucn=function(a,b){var c=false;for(var p in cz){if(cz[p]==a){c=true}}if(c){return}else{cz[a]=b}};G.naviByPos=function(a){if(!a.x){a=eval("("+a+")")}var x=a.x;var y=a.y;var z=a.z;this.naviToPos(x,y,z)};G.naviBtPos=function(a){if(!a.x1){a=eval("("+a+")")}var b=a.x1;var c=a.y1;var d=a.z1;var e=a.x2;var f=a.y2;var g=a.z2;this.naviBetweenPos(b,c,d,e,f,g)};G.getOritation=function(a){var b=eval("("+a+")");W=parseFloat(b.heading)};var cH=null;function registerSetParamCallback(a){cH=a}G.setParam=function(a,b){var c={"paraName":a,"paraValue":b};c=JSON.stringify(c);if(cH){cH(c)}try{WebJS.setParam(a,b)}catch(e){}};G.getPoiByIdInner=function(a){var b=by.length;var c=null;for(var i=0;i<b;i++){if(by[i].id==a){c=by[i]}}return c};G.getPoiById=function(a){var b=by.length;var c=null;for(var i=0;i<b;i++){if(by[i].id==a){c=by[i]}}var d=JSON.stringify(c);this.setParam("getPoiById",d);return c};G.getPoisAll=function(){var a=JSON.stringify(by);this.setParam("getPoisAll",a);return by};G.getNaviPathByPos=function(a){if(!a.x1){a=eval("("+a+")")}var b=a.x1;var c=a.y1;var d=a.z1;var e=a.x2;var f=a.y2;var g=a.z2;var h=a.funcName;this.callAjaxFunc("computePathOnly",b,c,d,e,f,g,h)};G.getShowFloor=function(){var a=this.getFloorNumberByIds("",bg);var b={"floorId":bg,"FloorNumber":a};var c=JSON.stringify(b);try{this.setParam("getShowFloor",c)}catch(e){}return b};G.createMarker=function(a){return this.createMarkerInner(a,"grp_userMarker")};G.deleteMarkerJS=function(a){this.deleteMarker(a,"grp_userMarker")};G.createMarkerInner=function(a,b){if(!a.width){a=eval("("+a+")")}var c=a.x;var d=a.y;var e=parseFloat(a.x)-a.width*0.5;var f=parseFloat(a.y)-a.height*0.5;var g=""+a.id;var h=Z.getElementById(b);if(!h){var h=document.createElementNS(bb,"g");h.id=b;h.style.zIndex=100;ba.appendChild(h)}var i=document.createElementNS(bb,"image");i.href.baseVal=a.href;i.setAttribute("preserveAspectRatio","xMidYMid meet");i.setAttribute("id",g);var j=0,levelto=5,offsetx=0,offsety=0;if(a.offsetx){offsetx=a.offsetx}if(a.offsety){offsety=a.offsety}if(a.levelfrom){j=a.levelfrom}if(a.levelto){levelto=a.levelto}$(i).attr("x",e).attr("y",f).attr("x0",c).attr("y0",d).attr("width",a.width).attr("height",a.height).attr("width0",a.width).attr("height0",a.height).attr("offsetx",offsetx).attr("offsety",offsety).attr("levelfrom",j).attr("levelto",levelto);h.appendChild(i);this.scaleMarkerReal(bG);return i};G.deleteMarker=function(a,b){var c=Z.getElementById("grp_userMarker");
var d=Z.getElementById(""+a);if(d){c.removeChild(d);return}};G.setAttributeMarker=function(a,b){for(var p in b){var c=b[p];var d=p;if(p=="width"){a.setAttribute("width0",c)}else{if(p=="height"){a.setAttribute("height0",c)}else{if(p=="x"){a.setAttribute("x0",c)}else{if(p=="y"){a.setAttribute("y0",c)}}}}a.setAttribute(d,c)}this.scaleMarkerReal(bG)};G.createText=function(a){return this.createTextInner(a,"grp_userText")};G.createTextInner=function(a,b){var c=Z.getElementById(b);if(!c){var c=document.createElementNS(bb,"g");c.id=b;c.style.zIndex=100;ba.appendChild(c)}if(!a.fontSize){a=eval("("+a+")")}var d=a.x;var e=a.y;var f=document.createElementNS(bb,"text");f.textContent=a.content;var g=4;var h="黑体";var i="#333333";var j="#ffffff";var k=0;var l=0;var m=0;var n=0;var o=5;if(a.fontSize){g=a.fontSize}if(a.fontFamily){h=a.fontFamily}if(a.fill){i=a.fill}if(a.stroke){j=a.stroke}if(a.strokeWidth){k=a.strokeWidth}if(a.offsetx){l=a.offsetx}if(a.offsety){m=a.offsety}if(a.levelfrom){n=a.levelfrom}if(a.levelto){o=a.levelto}$(f).attr("id",a.id).attr("x",d).attr("y",e).attr("x0",d).attr("y0",e).attr("font-size",g).attr("font-size0",g).attr("font-family",h).attr("fill",i).attr("stroke",j).attr("stroke-width",k).attr("stroke-width0",k).attr("offsetx",l).attr("offsety",m).attr("levelfrom",n).attr("levelto",o);c.appendChild(f);this.scaleTReal(bG);return f};G.deleteTextById=function(a,b){var c=Z.getElementById("grp_userText");var d=Z.getElementById(""+a);if(d){c.removeChild(d);return}};G.deleteText=function(a,b){var c=Z.getElementById("grp_userText");if(a){c.removeChild(a);return}};G.setAttributeText=function(a,b){for(var p in b){var c=b[p];var d=p;if(p=="fontFamily"){d="font-family"}else{if(p=="fontSize"){d="font-size";a.setAttribute("font-size0",c)}else{if(p=="strokeWidth"){d="stroke-width";a.setAttribute("stroke-width0",c)}else{if(p=="content"){a.firstChild.nodeValue=c}else{if(p=="x"){a.setAttribute("x0",c)}else{if(p=="y"){a.setAttribute("y0",c)}}}}}}a.setAttribute(d,c)}this.scaleTReal(bG)};G.naviById=function(a){if(a!=""){var b=null;var c=by.length;for(var i=0;i<c;i++){if(by[i].id==a){b=by[i].pos3d}}if(b==null){return}G.naviToPos(b[0],b[1],b[2])}};G.scaleMarkerReal=function(a){var b=Z.getElementById("grp_userMarker");if(!b){return}var c=b.childElementCount;for(var i=0;i<c;i++){try{try{var d=b.children[i]}catch(e){var d=b.childNodes.item(i)}var f=parseFloat(d.getAttribute("width0"));var g=parseFloat(d.getAttribute("height0"));var h=d.getAttribute("levelfrom");var j=d.getAttribute("levelto");if(bG<h||bG>j){k=0;l=0}else{var k=a*f;var l=a*g}d.setAttribute("width",k);d.setAttribute("height",l);var m=parseFloat(d.getAttribute("x0"));var n=parseFloat(d.getAttribute("y0"));var o=parseFloat(d.getAttribute("offsetx"));var p=parseFloat(d.getAttribute("offsety"));if(!o){o=0}if(!p){p=0}var q=a*o*0.5;var r=a*p*0.5;var s=m-(a*f*0.5)+q;var t=n-(a*g*0.5)+r;d.setAttribute("x",s);d.setAttribute("y",t)}catch(e){}}};G.scaleTReal=function(a){var b=Z.getElementById("grp_userText");if(!b){return}var c=b.childElementCount;for(var i=0;i<c;i++){try{try{var d=b.children[i]}catch(e){var d=b.childNodes.item(i)}var f=d.getAttribute("font-size0");var g=d.getAttribute("stroke-width0");var h=d.getAttribute("levelfrom");var j=d.getAttribute("levelto");if(bG<h||bG>j){k=0}else{var k=a*f*1}d.setAttribute("font-size",k);d.setAttribute("stroke-width",a*g*0.2);var l=parseFloat(d.getAttribute("x0"));var m=parseFloat(d.getAttribute("y0"));var n=0;var o=0;var p=parseFloat(d.getAttribute("offsetx"));var q=parseFloat(d.getAttribute("offsety"));if(!p){p=0}if(!q){q=0}n=a*p*0.5;o=a*q*0.5;var r=l+(a*f*0.5)+n;var s=m+(a*f*0.5)+o;d.setAttribute("x",r);d.setAttribute("y",s)}catch(e){}}};G.scaleViewToFactor=function(a){var b=a/bG;this.scaleViewProcess(b)};G.setInitPos=function(a){var b=a.split(" ");bh[0]=b[0];bh[1]=b[1];bh[2]=b[2];try{bh[3]=b[3]}catch(e){}};G.initScene();return G}};var callbackSetMusic=null;function registerSetMusicCallback(a){callbackSetMusic=a}function setMusic(a){if(callbackSetMusic){callbackSetMusic(a)}try{WebJS.setMusic(a)}catch(e){}}var callbackSetParam=null;function registerSetParamCallback(a){callbackSetParam=a}function setParam(a,b){var c={"paraName":a,"paraValue":b};c=JSON.stringify(c);if(callbackSetParam){callbackSetParam(c)}var d=a+"||"+b;try{WebJS.setParam(a,b)}catch(e){}}function getParam(a,b){if(a=="createMarker"){b=eval("("+b+")");map1.createMarker(b)}else{if(a=="deleteMarker"){map1.deleteMarkerJS(b)}else{if(a=="getPoiById"){map1.getPoiById(b)}else{if(a=="naviById"){map1.naviById(b)}else{var c="map1."+a;eval(c)(b)}}}}}function setScanIbeacon(a){map1.setScanIbeacon(a)};